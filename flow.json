[
    {
        "id": "c740254358c79788",
        "type": "tab",
        "label": "Links",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "c8b39bad946d8ab6",
        "type": "tab",
        "label": "Auth Module",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "2d9205901ae51ca8",
        "type": "tab",
        "label": "Categories",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "3b4e140713945201",
        "type": "tab",
        "label": "Flow 1",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "a1d95bc639a6eb03",
        "type": "tab",
        "label": "Series",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "aa0dea3e1560be14",
        "type": "tab",
        "label": "CSS",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "3b3162a2cd4b8878",
        "type": "tab",
        "label": "Attributes",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "7fa20f64a683a2de",
        "type": "tab",
        "label": "Products",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "831d0299e53b0c29",
        "type": "tab",
        "label": "Validation",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "9c49629805242044",
        "type": "subflow",
        "name": "Check slug",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 100,
                "wires": [
                    {
                        "id": "9c8321f24be8e37d"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 760,
                "y": 80,
                "wires": [
                    {
                        "id": "8f88b92bc62644eb",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#87A980",
        "icon": "font-awesome/fa-check-circle-o"
    },
    {
        "id": "95370d1e369768c7",
        "type": "subflow",
        "name": "woo commerce request",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 80,
                "y": 180,
                "wires": [
                    {
                        "id": "b8f879f25e83291f"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 940,
                "y": 80,
                "wires": [
                    {
                        "id": "f2561f871ab28502",
                        "port": 0
                    }
                ]
            },
            {
                "x": 940,
                "y": 280,
                "wires": [
                    {
                        "id": "f2561f871ab28502",
                        "port": 1
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#E7E7AE",
        "icon": "font-awesome/fa-send-o"
    },
    {
        "id": "81031a41452292e5",
        "type": "group",
        "z": "c8b39bad946d8ab6",
        "name": "Roles",
        "style": {
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "04ab9e97bf9e23e7",
            "84a24b2bf96c7d10",
            "561598685195f480",
            "c5be1687df4038a9",
            "fe134326442270d0",
            "a5211f330054a0f9",
            "b0766e91bd6c6a00",
            "d9487f0690457157",
            "9710436b969b38d7",
            "68b716a28a9c06f9",
            "31c23a05e29832de",
            "67d53a0197042a25",
            "e7c108f3663fd09c",
            "22579b498a3c1141",
            "69547a71e13702ba",
            "c2a121b11062dbc8",
            "99069fd281c3aa62",
            "1abe7468edf9c502",
            "3baac374b1dd3f4d",
            "ee3708d6d2779c2c",
            "3594cb050006f93b",
            "612e0a2b392767a6",
            "d223f3d36f46a91d",
            "731ac723f96cc33b",
            "d4d3c04525b14ac7",
            "05fb3fe7ecd5c415",
            "d805f50510a64b71",
            "110f980283b587bc",
            "b26cafe18475e3cb",
            "97c44ea10c943cb4",
            "c1c36f3949756248",
            "306adf550fae80e8"
        ],
        "x": 14,
        "y": 1119
    },
    {
        "id": "d78377c07a215120",
        "type": "group",
        "z": "c8b39bad946d8ab6",
        "name": "Authorization",
        "style": {
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "5c6e2dd94ba411ce",
            "672799ed948f1313",
            "b085f10213c6a2fc",
            "e594c405f087b6cf",
            "0608e9f35bdcacf1",
            "1adb12ad2ffdeb42",
            "d8b4284445386cd5",
            "d390b9504c129252",
            "b457f0b5c3fd5d96",
            "097b05d6f95dab62",
            "33a4e3695faf855e",
            "47a3231e1f267545",
            "dd3e208dfbba0a56",
            "265641df05c1ca83",
            "de79ea462e97e016",
            "73893182e2e2ed57",
            "cfc7631182b5ef67",
            "e8da10b5c113d139",
            "87b2820c2bf1143e",
            "21e68f3de4fa527b",
            "c4baf76948a8dc38",
            "a602a24988dcc60f",
            "77f7fee169a929cd",
            "a1180b2b1b551c2c",
            "6f81187c8d88e4de",
            "1a6b5d862a0b4bfc",
            "ca2dc46c7edc0fb2",
            "2d9ec1b926f8fb35",
            "1b7ab9bcbae8961f",
            "e49d1c22247329f1",
            "be2ed7f861399f69",
            "962e2be5ddd19cfc",
            "a4b43da2c7ab788f",
            "79c17e7d8ed1f939",
            "c67252247235be7c",
            "d8f65e08d1802e8e",
            "92a82d990292b9c2",
            "95ce8e1f931c2caa",
            "b42cb8e11e780105",
            "9b40d9caf853741d",
            "7ad3662b16de3eaf",
            "e653dc9c2aa956f2",
            "0b6ff6d92b1de7e7",
            "2a2d93b53c8a1966",
            "26ad7dce297ad8e7",
            "e26194f8f4aedcd3",
            "f2f94b0b491998e3",
            "e4082ecde347ac24",
            "9ed90dc87878d5c1",
            "831f0bc99fde7925",
            "376f7da2f0d85f32",
            "9da58b8ba7897ee6",
            "a7f063573564d610",
            "be700872e8a93107",
            "bb1864602327c1ca",
            "eed04ab51fe181f6",
            "6197204f97d99e26",
            "8c18463582ac198c",
            "c156d588bb3ba207",
            "406b08af64a38632",
            "46d2feb29eb7f617",
            "ba0fdb3c55f49767",
            "3b0fca787d0682d1",
            "99544f5cb03a9f23",
            "32fb51525caa70d8",
            "c193a98b11e16770",
            "f833e1216c97cff7",
            "d2dc6d60f2aadf80",
            "62ac94f341138925",
            "71d0784401d97a30",
            "6012ab98a19cbb6a",
            "ccbf43ec2e0f83d7",
            "e69809f9f1b11215",
            "862f69abf4db399d",
            "e9e5b74b5109f5de"
        ],
        "x": 14,
        "y": 19
    },
    {
        "id": "2229ae9934019399",
        "type": "group",
        "z": "c8b39bad946d8ab6",
        "name": "Confirm Email Registration",
        "style": {
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "6d762311464829e7",
            "9a785ddcdaf6df0d",
            "9ef904e08c1b1ac1",
            "13e4e31799cdc417",
            "b4488590d344582f",
            "19089ad57199af39",
            "5fe531e8c9bf55b6",
            "636a9bb0cdc28a94",
            "85976ad92833929a",
            "a2b1bc579a4c0ced"
        ],
        "x": 774,
        "y": 1119
    },
    {
        "id": "3b2ecc05f3cef5f7",
        "type": "group",
        "z": "c8b39bad946d8ab6",
        "name": "User Management",
        "style": {
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "2083b217673380ca",
            "ac9687b0e33d5319",
            "5189344f4260b4cb",
            "5cc768d59c9037f5",
            "58eb2605635a4f7e",
            "66961bddfd5aa161",
            "08b7f75f949f6937",
            "258e18ed74ffabde",
            "655fc308a4013906",
            "2709d229c1198629",
            "9a2fd6bca89c1339",
            "277dc08e100cba9a",
            "4e1a1ed5f5566238",
            "bdb1c0ed58d664b3",
            "90ea91af87880852",
            "47d7659c57682dc5",
            "0148d4c43311575a",
            "edf7b992521b758b",
            "bfda0ffbb10779bc",
            "27f0b8a5b141ccfd",
            "0ad420bdb40c7f48",
            "44c147950358453b",
            "0107039c4340e3b2",
            "e82f14a9819d4d19",
            "37630c5145f4933f",
            "375a3db843bf5ca4",
            "23e86f24046953d6",
            "4c2bfcca94198e63",
            "97840b426439aec0",
            "bd903ea2c5d6bd1c"
        ],
        "x": 14,
        "y": 3019
    },
    {
        "id": "a8bcf74ef7690d27",
        "type": "group",
        "z": "c8b39bad946d8ab6",
        "name": "Modules",
        "style": {
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "081c8c3d3092e3d2",
            "8c9188bca9c91600",
            "8e90850289063c0f",
            "ca87b60d60b99eb0",
            "48a302c4afb1b770",
            "c3b02c1f4edbee09",
            "2b147567f51c6f9d",
            "8155b8084ded1330",
            "94ae2989955beeda",
            "b017876ae60e280c",
            "98b2c82db768e5e1",
            "edf06a17bf884f9f",
            "33228ac20bb88129",
            "8a003992c216e032",
            "8886a378d607c9c3",
            "cdf04d878afee1d5",
            "5cbf5ba2c4c74a4f",
            "64d32109fbb50503",
            "149aa57b044f0aac",
            "b473ee4234249f14",
            "620b6e5d1c9e4858",
            "d868f70232c05f3c",
            "382da0ed3f1de901",
            "c13b3599b3b92508",
            "27bfc0517835a179",
            "03b23aac01f7893f",
            "411b69c681820b0e",
            "500861a5b5623bc5",
            "cd5c1d01d15467f7",
            "81bdba71023d5429",
            "3000e64189b3ff39",
            "943cda0940fbfc65",
            "6d5c9e567735125f",
            "0d8e4b5e24ee7f2c",
            "080f87898258c1e5",
            "3835bedd5b59284c",
            "acef5e4ee852a34b",
            "920e683749d9b015",
            "7001dd6d6d4622d6",
            "ae293692fead8475",
            "732470b6749e6a6e",
            "84af4b543dc711ed"
        ],
        "x": 14,
        "y": 2059
    },
    {
        "id": "5bf7ccb6c6709633",
        "type": "group",
        "z": "c8b39bad946d8ab6",
        "name": "Reset Paaword",
        "style": {
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "970bf1d3e8383bba",
            "c823a259da378156",
            "2082fa66df328468",
            "3b262e8c754b5f29",
            "bdbcc19d02a07b56",
            "9c78085fd79972cb",
            "2eda0c91d0b75786",
            "2687dc71562c4d72",
            "f1f861b64944b804",
            "d09ec9996f8a154c",
            "17248297231b9d88",
            "d8e9faa5f5797221",
            "59a6366d8be0ed5e",
            "a605c9337c4c16d3",
            "ed02bf967732b00f",
            "a92c36a6ee2e65ce",
            "97dc27c464c28717",
            "4f97e46839f52868",
            "d52f6d33dbea5a1b",
            "8eb1eca7b6974e66",
            "ddf35fbb3e263951",
            "0d5a011ed0707629",
            "2212b62e77474999",
            "d32809a33993ab1c",
            "6730dfa61287b9f2",
            "19690b9c050dd6f9",
            "a2eb69e6ad5db371",
            "80ae78b49345f62c",
            "654fcb097eed7e68",
            "9fe3a92c904e973d",
            "71ea35313c1e5bbe",
            "d12866b139615b07",
            "45455fa4faeda4c6",
            "c4d39042ddfb3c4c",
            "ca0b1f9a3c42aad6",
            "7df30165a4d0a7eb",
            "36a8ed88d4ee5217",
            "2fb7515b09f5d74a",
            "df7f03d335a3ce5b"
        ],
        "x": 774,
        "y": 1319
    },
    {
        "id": "629d10c36b4dfe77",
        "type": "group",
        "z": "2d9205901ae51ca8",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "99fbe13dd59a33fc",
            "72508a7c03713f9b",
            "2c921fabc757fcf0",
            "72bf5cf7c2ccfe10",
            "e2959056e055babf",
            "e9dd09ddd43cc418",
            "853eb1a668ed5d52",
            "e99cd1a49f29f041",
            "1662e0c4bb1b6964",
            "70a23afb33828b3f",
            "6c9691cfca401519",
            "b8bbb554f7193525",
            "413e0304929b65e9",
            "d1c918821bb50c6a",
            "49c30689feaa8461",
            "17d84524f816985e",
            "13bebcef94ddb1a1",
            "1a831082c4ec02e1",
            "d843e947608adfe2",
            "4612cf60103ea4e9",
            "21681a0e93af8404",
            "f4a7ffaa1fe9daa3",
            "8a5f8c42e08af4a4",
            "d64fca651f36b449",
            "f7dfab3838b75b27",
            "97eb537ba79e1caa",
            "a07ab63e69ae61d8",
            "c56e73263d461df9",
            "e643d3173683741d",
            "604a654072259b5a",
            "084cef6caf0afe50",
            "426bd3e00d7ee8b1",
            "5bf54fc5c3c30d7e",
            "3cef1644d4710622",
            "084e03545305bcab",
            "dd2956d7767d94a7",
            "4441ee4978cd8588",
            "15df488e0f2db9c1",
            "db3d8a0225404425"
        ],
        "x": 14,
        "y": 19
    },
    {
        "id": "eef59e6e9401d087",
        "type": "mongodb",
        "hostname": "127.0.0.1",
        "topology": "direct",
        "connectOptions": "",
        "port": "27017",
        "db": "",
        "name": ""
    },
    {
        "id": "f35a4cbb4c138ff6",
        "type": "mongodb",
        "hostname": "mongo-ubos-b4vgb-mongo.ubos-b4vgb",
        "topology": "direct",
        "connectOptions": "authSource=admin",
        "port": "27017",
        "db": "mongo",
        "name": "mongo"
    },
    {
        "id": "acbe556b4e16a2c1",
        "type": "mongodb",
        "hostname": "${DB_HOST}",
        "topology": "direct",
        "connectOptions": "authSource=admin",
        "port": "27017",
        "db": "${DATABASE}",
        "name": "env_mongo"
    },
    {
        "id": "97d9306de38b7617",
        "type": "link call",
        "z": "9c49629805242044",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 390,
        "y": 100,
        "wires": [
            [
                "8f88b92bc62644eb"
            ]
        ]
    },
    {
        "id": "9c8321f24be8e37d",
        "type": "function",
        "z": "9c49629805242044",
        "name": "function",
        "func": "\nmsg.payload = {\n    slug: msg.payload.slug,\n    deleted: false\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 220,
        "y": 100,
        "wires": [
            [
                "97d9306de38b7617"
            ]
        ]
    },
    {
        "id": "8f88b92bc62644eb",
        "type": "function",
        "z": "9c49629805242044",
        "name": "function",
        "func": "if(msg.payload.lenght > 0){\n    return [null, msg]\n}else{\n    msg.payload = {\n        ...msg.fromApp\n    }\n    return [msg, null]\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 100,
        "wires": [
            [],
            [
                "1bed50e2a8513918"
            ]
        ]
    },
    {
        "id": "1bed50e2a8513918",
        "type": "function",
        "z": "9c49629805242044",
        "name": "Already exist",
        "func": "msg.payload = {\n    success: false,\n    error: `400 slug already exist`\n}\nmsg.statusCode = 400;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 140,
        "wires": [
            [
                "9fa7c510772d5a9a"
            ]
        ]
    },
    {
        "id": "9fa7c510772d5a9a",
        "type": "http response",
        "z": "9c49629805242044",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 930,
        "y": 140,
        "wires": []
    },
    {
        "id": "5e3060d0cefc70f4",
        "type": "http request",
        "z": "95370d1e369768c7",
        "name": "",
        "method": "use",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 530,
        "y": 180,
        "wires": [
            [
                "f2561f871ab28502",
                "2ec6d1f8d8ba4022"
            ]
        ]
    },
    {
        "id": "b8f879f25e83291f",
        "type": "function",
        "z": "95370d1e369768c7",
        "name": "authToWoocommerce",
        "func": "let token = Buffer.from(`${env.get(\"WOOCOMMERCE_CONSUMER_KEY\")}\n:${env.get(\"WOOCOMMERCE_CONSUMER_SECRET\")}`).toString('base64');\nmsg.headers = {\n    \"Authorization\": `Basic ${token}`\n}\nmsg.url = env.get(\"BASE_URL\") + msg.endpoint\nmsg.method = msg.method\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 180,
        "wires": [
            [
                "5e3060d0cefc70f4",
                "9aee8bcecd689581"
            ]
        ]
    },
    {
        "id": "f2561f871ab28502",
        "type": "function",
        "z": "95370d1e369768c7",
        "name": "checkStatus",
        "func": "if (msg.statusCode == 201 || msg.statusCode == 200) {\n    return [msg, null]\n} else {\n    return [null, msg]\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 180,
        "wires": [
            [
                "cead28eaed949ab2"
            ],
            [
                "cead28eaed949ab2"
            ]
        ]
    },
    {
        "id": "cead28eaed949ab2",
        "type": "debug",
        "z": "95370d1e369768c7",
        "name": "Woocommerce",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1060,
        "y": 180,
        "wires": []
    },
    {
        "id": "9aee8bcecd689581",
        "type": "debug",
        "z": "95370d1e369768c7",
        "name": "debug 11",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 520,
        "y": 240,
        "wires": []
    },
    {
        "id": "2ec6d1f8d8ba4022",
        "type": "debug",
        "z": "95370d1e369768c7",
        "name": "debug 18",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "statusCode",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 760,
        "y": 140,
        "wires": []
    },
    {
        "id": "346e518816416d1d",
        "type": "link in",
        "z": "c740254358c79788",
        "name": "mongo Find",
        "links": [],
        "x": 245,
        "y": 140,
        "wires": [
            [
                "a902fac8c21085e6"
            ]
        ]
    },
    {
        "id": "b7c366424b9b7e6e",
        "type": "link in",
        "z": "c740254358c79788",
        "name": "mongo Aggregate",
        "links": [],
        "x": 245,
        "y": 200,
        "wires": [
            [
                "84c75bed55ab1dd8"
            ]
        ]
    },
    {
        "id": "1764f8568a80ddbd",
        "type": "link in",
        "z": "c740254358c79788",
        "name": "mongo Insert",
        "links": [],
        "x": 255,
        "y": 320,
        "wires": [
            [
                "7739c6ef4683fa04",
                "7ce3e0949b4a483f"
            ]
        ]
    },
    {
        "id": "286431cd31c9fc7a",
        "type": "link in",
        "z": "c740254358c79788",
        "name": "mongo Update",
        "links": [],
        "x": 255,
        "y": 380,
        "wires": [
            [
                "5accd99f247f88ec",
                "6a3c98d4b6b016de"
            ]
        ]
    },
    {
        "id": "4307ecabcc6486c7",
        "type": "link out",
        "z": "c740254358c79788",
        "name": "link out 1",
        "mode": "return",
        "links": [],
        "x": 505,
        "y": 140,
        "wires": []
    },
    {
        "id": "6544322b922c1a49",
        "type": "link out",
        "z": "c740254358c79788",
        "name": "link out 2",
        "mode": "return",
        "links": [],
        "x": 505,
        "y": 200,
        "wires": []
    },
    {
        "id": "7739c6ef4683fa04",
        "type": "link out",
        "z": "c740254358c79788",
        "name": "link out 4",
        "mode": "return",
        "links": [],
        "x": 405,
        "y": 280,
        "wires": []
    },
    {
        "id": "5accd99f247f88ec",
        "type": "link out",
        "z": "c740254358c79788",
        "name": "link out 5",
        "mode": "return",
        "links": [],
        "x": 385,
        "y": 480,
        "wires": []
    },
    {
        "id": "a902fac8c21085e6",
        "type": "mongodb in",
        "z": "c740254358c79788",
        "mongodb": "acbe556b4e16a2c1",
        "name": "",
        "collection": "",
        "operation": "find",
        "x": 370,
        "y": 140,
        "wires": [
            [
                "4307ecabcc6486c7"
            ]
        ]
    },
    {
        "id": "84c75bed55ab1dd8",
        "type": "mongodb in",
        "z": "c740254358c79788",
        "mongodb": "acbe556b4e16a2c1",
        "name": "",
        "collection": "",
        "operation": "aggregate",
        "x": 410,
        "y": 200,
        "wires": [
            [
                "6544322b922c1a49"
            ]
        ]
    },
    {
        "id": "7ce3e0949b4a483f",
        "type": "mongodb out",
        "z": "c740254358c79788",
        "mongodb": "acbe556b4e16a2c1",
        "name": "",
        "collection": "",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "insert",
        "x": 450,
        "y": 320,
        "wires": []
    },
    {
        "id": "6a3c98d4b6b016de",
        "type": "mongodb out",
        "z": "c740254358c79788",
        "mongodb": "acbe556b4e16a2c1",
        "name": "",
        "collection": "",
        "payonly": false,
        "upsert": false,
        "multi": false,
        "operation": "update",
        "x": 450,
        "y": 380,
        "wires": []
    },
    {
        "id": "71d0784401d97a30",
        "type": "http in",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "registration",
        "url": "/registration",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 100,
        "y": 460,
        "wires": [
            [
                "f2f94b0b491998e3",
                "e26194f8f4aedcd3"
            ]
        ],
        "icon": "node-red/arrow-in.svg"
    },
    {
        "id": "ccbf43ec2e0f83d7",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 650,
        "y": 520,
        "wires": []
    },
    {
        "id": "04ab9e97bf9e23e7",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "",
        "func": "msg.collection = \"admin_roles\";\n\nmsg.payload={\n    name:msg.payload.name,\n    deleted:false,\n    permissions: [],\n    createdAt: new Date((new Date().toISOString()))\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 1420,
        "wires": [
            [
                "561598685195f480",
                "9710436b969b38d7"
            ]
        ]
    },
    {
        "id": "84a24b2bf96c7d10",
        "type": "http in",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "createRole",
        "url": "/createRole",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 100,
        "y": 1420,
        "wires": [
            [
                "04ab9e97bf9e23e7"
            ]
        ],
        "icon": "node-red/arrow-in.svg"
    },
    {
        "id": "561598685195f480",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 410,
        "y": 1440,
        "wires": []
    },
    {
        "id": "c5be1687df4038a9",
        "type": "http in",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "getRoles",
        "url": "/getRoles",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 100,
        "y": 1200,
        "wires": [
            [
                "68b716a28a9c06f9"
            ]
        ]
    },
    {
        "id": "fe134326442270d0",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 590,
        "y": 1200,
        "wires": []
    },
    {
        "id": "a5211f330054a0f9",
        "type": "http in",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "addModuleToRole",
        "url": "/addModuleToRole",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 130,
        "y": 1560,
        "wires": [
            [
                "d9487f0690457157",
                "05fb3fe7ecd5c415"
            ]
        ],
        "icon": "node-red/arrow-in.svg"
    },
    {
        "id": "b0766e91bd6c6a00",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 470,
        "y": 1580,
        "wires": []
    },
    {
        "id": "d9487f0690457157",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "",
        "func": "msg.collection = \"admin_roles\";\n\nlet crud = {\n    \"canCreate\": false,\n    \"canRead\": false,\n    \"canEdit\": false,\n    \"canRemove\": false\n}\n\nmsg.payload.options.map(e => {\n    if (e == \"C\") {\n        crud.canCreate = true\n    }\n    else if (e == \"R\") {\n        crud.canRead = true\n    }\n    else if (e == \"U\") {\n        crud.canEdit = true\n    } else if (e == \"D\") {\n        crud.canRemove = true\n    }\n})\n\n\nlet modules = msg.payload.moduleName.map((name, index)=> {\n    return {\n        \"name\": name,\n        \"value\": msg.payload.moduleValue[index]\n    }\n\n})\n\nlet preparedModules\n = modules.map(item => {\n    return{\n        module: item.name,\n        moduleId: objectid(item.value),\n        ...crud\n    }\n})\n\nmsg.query={\n    \"_id\":objectid(msg.payload._id)\n}\n\nmsg.payload={\n    $push: {\n        permissions: {\n            $each: [...preparedModules]\n        }\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 320,
        "y": 1560,
        "wires": [
            [
                "b0766e91bd6c6a00",
                "67d53a0197042a25"
            ]
        ]
    },
    {
        "id": "9710436b969b38d7",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "",
        "links": [
            "1764f8568a80ddbd"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 430,
        "y": 1400,
        "wires": [
            []
        ]
    },
    {
        "id": "68b716a28a9c06f9",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "",
        "func": "msg.collection=\"admin_roles\"\nmsg.payload={\n    deleted: false\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 1200,
        "wires": [
            [
                "31c23a05e29832de"
            ]
        ]
    },
    {
        "id": "31c23a05e29832de",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 430,
        "y": 1200,
        "wires": [
            [
                "fe134326442270d0",
                "d805f50510a64b71"
            ]
        ]
    },
    {
        "id": "67d53a0197042a25",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "",
        "links": [
            "286431cd31c9fc7a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 520,
        "y": 1540,
        "wires": [
            []
        ]
    },
    {
        "id": "e7c108f3663fd09c",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "",
        "func": "msg.collection =\"admin_roles\"\n\nmsg.query={\n    _id: objectid(msg.payload._id)\n}\n\nmsg.payload={\n    $set:{\n        name: msg.payload.name\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 280,
        "y": 1680,
        "wires": [
            [
                "69547a71e13702ba",
                "c2a121b11062dbc8"
            ]
        ]
    },
    {
        "id": "22579b498a3c1141",
        "type": "http in",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "updateRole",
        "url": "/updateRole",
        "method": "put",
        "upload": false,
        "swaggerDoc": "",
        "x": 110,
        "y": 1680,
        "wires": [
            [
                "e7c108f3663fd09c"
            ]
        ],
        "icon": "font-awesome/fa-edit"
    },
    {
        "id": "69547a71e13702ba",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "",
        "links": [
            "286431cd31c9fc7a"
        ],
        "linkType": "static",
        "timeout": "10",
        "x": 480,
        "y": 1660,
        "wires": [
            []
        ]
    },
    {
        "id": "c2a121b11062dbc8",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 430,
        "y": 1700,
        "wires": []
    },
    {
        "id": "99069fd281c3aa62",
        "type": "http in",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "deleteModuleFromRole",
        "url": "/deleteModuleFromRole",
        "method": "delete",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 1940,
        "wires": [
            [
                "1abe7468edf9c502"
            ]
        ],
        "icon": "font-awesome/fa-remove"
    },
    {
        "id": "1abe7468edf9c502",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "",
        "func": "msg.collection = \"admin_roles\";\n\nmsg.query = {\n   \"_id\": objectid(msg.payload._id)\n};\n\nconst deleteModulesId = msg.payload.moduleId.map(i => objectid(i));\n\nmsg.payload = {\n    $pull: {\n        permissions: {\n            moduleId: {\n                $in: deleteModulesId\n            }\n        }\n    }\n}\n\n// msg.payload = {\n//     $pull: {\n//         \"permissions\": {\n//             \"moduleId\": objectid(msg.payload.moduleId)\n//         }\n//     }\n// }\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 340,
        "y": 1940,
        "wires": [
            [
                "3baac374b1dd3f4d",
                "731ac723f96cc33b",
                "d4d3c04525b14ac7"
            ]
        ]
    },
    {
        "id": "3baac374b1dd3f4d",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "",
        "links": [
            "286431cd31c9fc7a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 540,
        "y": 1980,
        "wires": [
            []
        ]
    },
    {
        "id": "ee3708d6d2779c2c",
        "type": "http in",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "deleteRole",
        "url": "/deleteRole",
        "method": "delete",
        "upload": false,
        "swaggerDoc": "",
        "x": 100,
        "y": 1800,
        "wires": [
            [
                "3594cb050006f93b"
            ]
        ],
        "icon": "font-awesome/fa-remove"
    },
    {
        "id": "3594cb050006f93b",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "",
        "func": "msg.collection =\"admin_roles\"\n\nmsg.query={\n    _id: objectid(msg.payload._id)\n}\n\nmsg.payload={\n    $set:{\n        deleted: true\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 260,
        "y": 1800,
        "wires": [
            [
                "d223f3d36f46a91d",
                "612e0a2b392767a6"
            ]
        ]
    },
    {
        "id": "612e0a2b392767a6",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 410,
        "y": 1820,
        "wires": []
    },
    {
        "id": "d223f3d36f46a91d",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "",
        "links": [
            "286431cd31c9fc7a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 460,
        "y": 1780,
        "wires": [
            []
        ]
    },
    {
        "id": "731ac723f96cc33b",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 490,
        "y": 1940,
        "wires": []
    },
    {
        "id": "d4d3c04525b14ac7",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 490,
        "y": 1900,
        "wires": []
    },
    {
        "id": "05fb3fe7ecd5c415",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 310,
        "y": 1520,
        "wires": []
    },
    {
        "id": "d805f50510a64b71",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "all Roles",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 600,
        "y": 1160,
        "wires": []
    },
    {
        "id": "110f980283b587bc",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "get roles",
        "func": "msg.collection = \"admin_roles\"\nlet match = {};\nif (msg.payload.name != \",\" && msg.payload.name) {\n    match = {\n        name: { $regex: msg.payload.name, $options: \"i\" }\n    }\n}\n\nmsg.payload = {\n    deleted: false, \n    ...match\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 1320,
        "wires": [
            [
                "b26cafe18475e3cb"
            ]
        ]
    },
    {
        "id": "b26cafe18475e3cb",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 450,
        "y": 1320,
        "wires": [
            [
                "c1c36f3949756248",
                "97c44ea10c943cb4"
            ]
        ]
    },
    {
        "id": "97c44ea10c943cb4",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "all roles",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 620,
        "y": 1280,
        "wires": []
    },
    {
        "id": "c1c36f3949756248",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 610,
        "y": 1320,
        "wires": []
    },
    {
        "id": "306adf550fae80e8",
        "type": "http in",
        "z": "c8b39bad946d8ab6",
        "g": "81031a41452292e5",
        "name": "getAllRoles",
        "url": "/getAllRoles",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 110,
        "y": 1320,
        "wires": [
            [
                "110f980283b587bc"
            ]
        ],
        "info": "Use in: User Management"
    },
    {
        "id": "081c8c3d3092e3d2",
        "type": "http in",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "createParentModule",
        "url": "/createParentModule",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 130,
        "y": 2260,
        "wires": [
            [
                "8e90850289063c0f",
                "c13b3599b3b92508"
            ]
        ],
        "icon": "node-red/arrow-in.svg"
    },
    {
        "id": "8c9188bca9c91600",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 510,
        "y": 2220,
        "wires": []
    },
    {
        "id": "8e90850289063c0f",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "",
        "func": "msg.collection = \"admin_modules\"\n\nmsg.payload = {\n    ...msg.payload,\n    deleted: false,\n    isParent: false\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 2260,
        "wires": [
            [
                "5cbf5ba2c4c74a4f",
                "8c9188bca9c91600"
            ]
        ]
    },
    {
        "id": "ca87b60d60b99eb0",
        "type": "http in",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "getModules",
        "url": "/getModules",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 110,
        "y": 2140,
        "wires": [
            [
                "c3b02c1f4edbee09"
            ]
        ]
    },
    {
        "id": "48a302c4afb1b770",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 630,
        "y": 2140,
        "wires": []
    },
    {
        "id": "c3b02c1f4edbee09",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "",
        "func": "msg.collection=\"admin_modules\"\nmsg.payload={\n    deleted:false\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 300,
        "y": 2140,
        "wires": [
            [
                "33228ac20bb88129"
            ]
        ]
    },
    {
        "id": "2b147567f51c6f9d",
        "type": "http in",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "createChildModule",
        "url": "/createChildModule",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 130,
        "y": 2660,
        "wires": [
            [
                "94ae2989955beeda"
            ]
        ],
        "icon": "node-red/arrow-in.svg"
    },
    {
        "id": "8155b8084ded1330",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 510,
        "y": 2660,
        "wires": []
    },
    {
        "id": "94ae2989955beeda",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "query",
        "func": "msg.collection = \"admin_modules\";\n\nif (msg.payload.parentModule) {\n    msg.query={\n        \"_id\": objectid(msg.payload.parentModule)\n    };\n\n    msg.payload = {\n        $addToSet: {\n            childModules: {\n                name: msg.payload.childModule,\n                page_id: msg.payload.childModule,\n                position: msg.payload.position\n            }\n        },\n        $set: {\n            isParent: true\n        }\n    }\n\n    return [msg,];\n} else {\n    \n    \n    msg.payload={\n        ...msg.payload,\n        deleted: false,\n        isParent: false\n    }\n    return [,msg];\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 350,
        "y": 2660,
        "wires": [
            [
                "cdf04d878afee1d5",
                "8155b8084ded1330"
            ],
            [
                "8886a378d607c9c3",
                "8155b8084ded1330"
            ]
        ]
    },
    {
        "id": "b017876ae60e280c",
        "type": "http in",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "deleteChildModule",
        "url": "/deleteChildModule",
        "method": "delete",
        "upload": false,
        "swaggerDoc": "",
        "x": 130,
        "y": 2940,
        "wires": [
            [
                "98b2c82db768e5e1",
                "64d32109fbb50503"
            ]
        ],
        "icon": "font-awesome/fa-remove"
    },
    {
        "id": "98b2c82db768e5e1",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "query",
        "func": "msg.collection=\"admin_modules\";\n\nmsg.query = {\n    \"_id\": objectid(msg.payload._id)\n};\n\nmsg.payload = {\n    $pull: {\n        \"childModules\": {\n            \"name\": msg.payload.childModule_id\n        }\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 350,
        "y": 2940,
        "wires": [
            [
                "8a003992c216e032",
                "edf06a17bf884f9f"
            ]
        ]
    },
    {
        "id": "edf06a17bf884f9f",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 510,
        "y": 2900,
        "wires": []
    },
    {
        "id": "33228ac20bb88129",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 470,
        "y": 2140,
        "wires": [
            [
                "48a302c4afb1b770",
                "27bfc0517835a179"
            ]
        ]
    },
    {
        "id": "8a003992c216e032",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "",
        "links": [
            "286431cd31c9fc7a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 540,
        "y": 2940,
        "wires": [
            []
        ]
    },
    {
        "id": "8886a378d607c9c3",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "",
        "links": [
            "1764f8568a80ddbd"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 530,
        "y": 2700,
        "wires": [
            []
        ]
    },
    {
        "id": "cdf04d878afee1d5",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "",
        "links": [
            "286431cd31c9fc7a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 540,
        "y": 2620,
        "wires": [
            []
        ]
    },
    {
        "id": "5cbf5ba2c4c74a4f",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "",
        "links": [
            "1764f8568a80ddbd"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 530,
        "y": 2260,
        "wires": [
            []
        ]
    },
    {
        "id": "64d32109fbb50503",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "came",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 350,
        "y": 2900,
        "wires": []
    },
    {
        "id": "149aa57b044f0aac",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "came",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 350,
        "y": 2780,
        "wires": []
    },
    {
        "id": "b473ee4234249f14",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "",
        "links": [
            "286431cd31c9fc7a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 560,
        "y": 2820,
        "wires": [
            []
        ]
    },
    {
        "id": "620b6e5d1c9e4858",
        "type": "http in",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "updateChildModule",
        "url": "/updateChildModule",
        "method": "put",
        "upload": false,
        "swaggerDoc": "",
        "x": 130,
        "y": 2820,
        "wires": [
            [
                "d868f70232c05f3c",
                "149aa57b044f0aac"
            ]
        ],
        "icon": "font-awesome/fa-edit"
    },
    {
        "id": "d868f70232c05f3c",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "query",
        "func": "msg.collection = \"admin_modules\";\n\nmsg.query = {\n    \"_id\": objectid(msg.payload._id),\n    \"childModules.name\": msg.payload.name\n};\n\nmsg.payload = {\n    $set: {\n        \"childModules.$.position\": msg.payload.position\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 350,
        "y": 2820,
        "wires": [
            [
                "b473ee4234249f14",
                "382da0ed3f1de901"
            ]
        ]
    },
    {
        "id": "382da0ed3f1de901",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 530,
        "y": 2780,
        "wires": []
    },
    {
        "id": "c13b3599b3b92508",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "came",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 350,
        "y": 2220,
        "wires": []
    },
    {
        "id": "27bfc0517835a179",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "all modules",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 650,
        "y": 2100,
        "wires": []
    },
    {
        "id": "2083b217673380ca",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "delete user query",
        "func": "msg.collection = \"admins\"\n\nmsg.query = {\n    \"_id\": objectid(msg.payload._id)\n};\n\nmsg.payload = {\n    $set: { \"deleted\": true }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 350,
        "y": 3380,
        "wires": [
            [
                "4e1a1ed5f5566238",
                "90ea91af87880852",
                "bdb1c0ed58d664b3"
            ]
        ]
    },
    {
        "id": "ac9687b0e33d5319",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "get users query",
        "func": "msg.collection = \"admins\";\n\nmsg.payload=[\n    {\n      $match:{\n        deleted:false\n      }\n    },\n    {\n      $lookup: {\n       \"from\": \"admin_roles\",\n       \"localField\": \"roles\",\n       \"foreignField\":\"_id\",\n       \"as\": \"role_items\"\n     }\n    }\n]\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 3100,
        "wires": [
            [
                "5cc768d59c9037f5",
                "bd903ea2c5d6bd1c"
            ]
        ]
    },
    {
        "id": "5189344f4260b4cb",
        "type": "http in",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "getUsers",
        "url": "/getUsers",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 100,
        "y": 3100,
        "wires": [
            [
                "ac9687b0e33d5319"
            ]
        ]
    },
    {
        "id": "5cc768d59c9037f5",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "",
        "links": [
            "b7c366424b9b7e6e"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 530,
        "y": 3100,
        "wires": [
            [
                "66961bddfd5aa161",
                "58eb2605635a4f7e"
            ]
        ]
    },
    {
        "id": "58eb2605635a4f7e",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 910,
        "y": 3100,
        "wires": []
    },
    {
        "id": "66961bddfd5aa161",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "all users",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 720,
        "y": 3060,
        "wires": []
    },
    {
        "id": "08b7f75f949f6937",
        "type": "http in",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "editUserRole",
        "url": "/editUserRole",
        "method": "put",
        "upload": false,
        "swaggerDoc": "",
        "x": 110,
        "y": 3220,
        "wires": [
            [
                "258e18ed74ffabde"
            ]
        ],
        "icon": "font-awesome/fa-edit"
    },
    {
        "id": "258e18ed74ffabde",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "edit role query",
        "func": "msg.collection = \"admins\";\n\nmsg.query = {\n    \"_id\": objectid(msg.payload._id)\n}\n\nmsg.payload = {\n    $set: {\n        \"roles\": [objectid(msg.payload.role)]\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 340,
        "y": 3220,
        "wires": [
            [
                "2709d229c1198629",
                "655fc308a4013906",
                "9a2fd6bca89c1339"
            ]
        ]
    },
    {
        "id": "655fc308a4013906",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "",
        "links": [
            "286431cd31c9fc7a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 560,
        "y": 3180,
        "wires": [
            []
        ]
    },
    {
        "id": "2709d229c1198629",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 510,
        "y": 3220,
        "wires": []
    },
    {
        "id": "9a2fd6bca89c1339",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "user role edited",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 540,
        "y": 3260,
        "wires": []
    },
    {
        "id": "277dc08e100cba9a",
        "type": "http in",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "deleteUser",
        "url": "/deleteUser",
        "method": "delete",
        "upload": true,
        "swaggerDoc": "",
        "x": 100,
        "y": 3380,
        "wires": [
            [
                "2083b217673380ca"
            ]
        ],
        "icon": "font-awesome/fa-remove"
    },
    {
        "id": "4e1a1ed5f5566238",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "deleteUser msg to DB",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 580,
        "y": 3420,
        "wires": []
    },
    {
        "id": "bdb1c0ed58d664b3",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 530,
        "y": 3380,
        "wires": []
    },
    {
        "id": "90ea91af87880852",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "",
        "links": [
            "286431cd31c9fc7a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 580,
        "y": 3340,
        "wires": [
            []
        ]
    },
    {
        "id": "47d7659c57682dc5",
        "type": "http in",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "createUser",
        "url": "/createUser",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 100,
        "y": 3560,
        "wires": [
            [
                "0148d4c43311575a",
                "edf7b992521b758b"
            ]
        ],
        "icon": "node-red/arrow-in.svg"
    },
    {
        "id": "0148d4c43311575a",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "query",
        "func": "msg.collection = \"admins\";\nmsg.oldpayload = msg.payload;\n\nmsg.payload = {\n    email: msg.payload.email,\n    deleted: false\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 3560,
        "wires": [
            [
                "bfda0ffbb10779bc",
                "27f0b8a5b141ccfd"
            ]
        ]
    },
    {
        "id": "edf7b992521b758b",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 310,
        "y": 3600,
        "wires": []
    },
    {
        "id": "bfda0ffbb10779bc",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 470,
        "y": 3560,
        "wires": [
            [
                "0ad420bdb40c7f48",
                "44c147950358453b"
            ]
        ]
    },
    {
        "id": "27f0b8a5b141ccfd",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "msg to db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 460,
        "y": 3520,
        "wires": []
    },
    {
        "id": "0ad420bdb40c7f48",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "check",
        "func": "if (msg.payload.length > 0) {\n    msg.payload = {\n        data: \"This email address already exists\",\n        code: 400,\n    }\n    return [null, msg]\n}\nelse{\n    return [msg, null]\n}\n\n\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 3560,
        "wires": [
            [
                "37630c5145f4933f",
                "375a3db843bf5ca4"
            ],
            [
                "0107039c4340e3b2",
                "e82f14a9819d4d19"
            ]
        ]
    },
    {
        "id": "44c147950358453b",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 630,
        "y": 3600,
        "wires": []
    },
    {
        "id": "0107039c4340e3b2",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "",
        "statusCode": "400",
        "headers": {},
        "x": 820,
        "y": 3600,
        "wires": []
    },
    {
        "id": "e82f14a9819d4d19",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "err when created user",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 860,
        "y": 3640,
        "wires": []
    },
    {
        "id": "37630c5145f4933f",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "registration user",
        "func": "let randomColor = \"#\" + Math.floor(Math.random() * 16777215).toString(16);\nlet encryptedPassword = await bcrypt.hash(msg.oldpayload.password, 10);\n\nmsg.payload = {\n    \"_id\": objectid(),\n    \"deleted\": false,\n    \"avatarColor\": randomColor,\n    \"createdAt\": new Date(),\n    \"roles\": [objectid(msg.oldpayload.role)],\n    \"active\": true,\n    \"firstname\": msg.oldpayload.firstname,\n    \"lastname\": msg.oldpayload.lastname,\n    \"email\": msg.oldpayload.email,\n    \"password\": encryptedPassword,\n    verifyToken: null,\n    resetPassToken: \"\",\n    resetPassExpireToken: null\n}\n\nreturn msg;\n\n\n\n\n\n\n\n// let randomColor = \"#\" + Math.floor(Math.random() * 16777215).toString(16);\n// let encryptedPassword = await bcrypt.hash(msg.oldpayload.password, 10);\n// const verifyToken = await jwt.sign(\n//     { id: Math.round(Math.random()) },\n//     \"test\",\n//     {\n//         expiresIn: \"150m\",\n//     }\n// );\n\n// msg.cookies = {};\n// msg.cookies[\"verify_token\"] = verifyToken;\n// msg.cookies[\"email_register\"] = msg.oldpayload.email;\n\n// msg.payload = {\n//     \"_id\": objectid(),\n//     \"deleted\": false,\n//     \"avatarColor\": randomColor,\n//     \"createdAt\": new Date(),\n//     \"roles\": [objectid(\"634fe97d28c82b00103cd25d\")],\n//     \"active\": false,\n//     \"firstname\": msg.oldpayload.firstname,\n//     \"lastname\": msg.oldpayload.lastname,\n//     \"email\": msg.oldpayload.email,\n//     \"password\": encryptedPassword,\n//     verifyToken,\n//     resetPassToken: \"\",\n//     resetPassExpireToken: null\n// }\n\n// return msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            },
            {
                "var": "bcrypt",
                "module": "bcrypt"
            },
            {
                "var": "jwt",
                "module": "jsonwebtoken"
            }
        ],
        "x": 840,
        "y": 3540,
        "wires": [
            [
                "23e86f24046953d6",
                "4c2bfcca94198e63",
                "97840b426439aec0"
            ]
        ]
    },
    {
        "id": "375a3db843bf5ca4",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 810,
        "y": 3500,
        "wires": []
    },
    {
        "id": "23e86f24046953d6",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1050,
        "y": 3580,
        "wires": []
    },
    {
        "id": "4c2bfcca94198e63",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "",
        "links": [
            "1764f8568a80ddbd"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1080,
        "y": 3500,
        "wires": [
            []
        ]
    },
    {
        "id": "97840b426439aec0",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1050,
        "y": 3540,
        "wires": []
    },
    {
        "id": "5c6e2dd94ba411ce",
        "type": "http in",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "login",
        "url": "/login",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 90,
        "y": 120,
        "wires": [
            [
                "672799ed948f1313",
                "1b7ab9bcbae8961f"
            ]
        ],
        "icon": "node-red/arrow-in.svg"
    },
    {
        "id": "672799ed948f1313",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "check",
        "func": "const regexEmail = /^(([^<>()[\\]\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@(([^<>()[\\]\\.,;:\\s@\\\"]+\\.)+[^<>()[\\]\\.,;:\\s@\\\"]{2,})$/i;\nconst regexPassword = /^(?!.*\\s).{8,}/;\nconst email = msg.payload.email.toLowerCase();\n\nif (!regexEmail.test(email)) {\n    msg.statusCode = 401;\n    msg.payload = {\n        data: \"Email is invalid\",\n        code: 401\n    }\n\n    return [null, msg];\n\n} else if (!regexPassword.test(msg.payload.password)) {\n    msg.statusCode = 401;\n    msg.payload = {\n        data: \"The password is invalid. The value must be at least 8 characters and without whitespaces\",\n        code: 401\n    }\n\n    return [null, msg];\n    \n} else {\n    msg.collection = \"admins\"\n    msg.fromApp = msg.payload\n\n    node.warn(msg.fromApp)\n\n    msg.payload = {\n        email: email,\n        deleted: false,\n        active: true\n    }\n\n    return [msg, null];\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 120,
        "wires": [
            [
                "d8f65e08d1802e8e",
                "9b40d9caf853741d"
            ],
            [
                "769c853fb108cedb",
                "53cd8649fa65084f"
            ]
        ]
    },
    {
        "id": "b085f10213c6a2fc",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1230,
        "y": 100,
        "wires": []
    },
    {
        "id": "e594c405f087b6cf",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "check auth",
        "func": "\nif(msg.payload.length === 0){\n    msg.statusCode = 401;\n    msg.payload = {\n        data: \"Incorrect email or password\",\n        code:401\n    }\n    node.warn(\"Email not found\");\n    return [null,msg]\n} else {\n\n    let check = await bcrypt.compare(msg.fromApp.password, msg.payload[0].password);\n\n    if (!check) {\n        msg.statusCode = 401;\n        msg.payload = {\n            data: \"Incorrect email or password\",\n            code: 401\n        }\n        node.warn(\"Password incorrect\");\n        return [null, msg]\n    }\n\n    if (msg.payload[0].active === false) {\n        msg.statusCode = 401;\n        msg.payload = {\n            data: \"Email not activated\",\n            code: 401\n        }\n        return [null, msg]\n    }\n}\n\n\n\nreturn[msg,null]",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "bcrypt",
                "module": "bcrypt"
            }
        ],
        "x": 850,
        "y": 120,
        "wires": [
            [
                "1adb12ad2ffdeb42",
                "77f7fee169a929cd"
            ],
            [
                "0608e9f35bdcacf1",
                "a1180b2b1b551c2c"
            ]
        ]
    },
    {
        "id": "0608e9f35bdcacf1",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1050,
        "y": 160,
        "wires": []
    },
    {
        "id": "1adb12ad2ffdeb42",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "jwt token",
        "func": "msg.payload = msg.payload[0]\nconst token = jwt.sign(\n    { user_id: msg.payload._id, email:msg.payload.email },\n    \"test\",\n    {\n        expiresIn: \"1400m\",\n    }\n);\n\nmsg.cookies = {};\nmsg.cookies[\"user_token\"] = token;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "jwt",
                "module": "jsonwebtoken"
            }
        ],
        "x": 1060,
        "y": 100,
        "wires": [
            [
                "b085f10213c6a2fc",
                "d8b4284445386cd5"
            ]
        ]
    },
    {
        "id": "d8b4284445386cd5",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1230,
        "y": 60,
        "wires": []
    },
    {
        "id": "d390b9504c129252",
        "type": "http in",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "check_token",
        "url": "/check_token",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 110,
        "y": 860,
        "wires": [
            [
                "097b05d6f95dab62",
                "47a3231e1f267545"
            ]
        ],
        "icon": "node-red/arrow-in.svg"
    },
    {
        "id": "b457f0b5c3fd5d96",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "statusCode": "401",
        "headers": {},
        "x": 1040,
        "y": 900,
        "wires": []
    },
    {
        "id": "097b05d6f95dab62",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "check jwt",
        "func": "msg.check = msg.payload;\nconst decoded = jwt.verify(msg.payload.token, 'test');\nmsg.payload = decoded\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "jwt",
                "module": "jsonwebtoken"
            }
        ],
        "x": 320,
        "y": 860,
        "wires": [
            [
                "33a4e3695faf855e",
                "73893182e2e2ed57"
            ]
        ]
    },
    {
        "id": "33a4e3695faf855e",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 490,
        "y": 820,
        "wires": []
    },
    {
        "id": "47a3231e1f267545",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "Checker",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 320,
        "y": 820,
        "wires": []
    },
    {
        "id": "dd3e208dfbba0a56",
        "type": "catch",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "scope": [
            "097b05d6f95dab62"
        ],
        "uncaught": false,
        "x": 100,
        "y": 960,
        "wires": [
            [
                "265641df05c1ca83",
                "21e68f3de4fa527b"
            ]
        ]
    },
    {
        "id": "265641df05c1ca83",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "func": "msg.payload = {\n    auth: \"Unautorizate\",\n    code: 401,\n    login_id: msg.check.login_id,\n    app_id: msg.check.app_id\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 270,
        "y": 960,
        "wires": [
            [
                "de79ea462e97e016",
                "e8da10b5c113d139"
            ]
        ]
    },
    {
        "id": "de79ea462e97e016",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 430,
        "y": 960,
        "wires": []
    },
    {
        "id": "73893182e2e2ed57",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "check",
        "func": "msg.collection = \"admins\"\nmsg.fromApp = msg.payload\nmsg.payload = {\n    // email : msg.fromApp.email,\n    _id: objectid(msg.payload.user_id),\n    deleted:false\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 490,
        "y": 860,
        "wires": [
            [
                "1a6b5d862a0b4bfc",
                "26ad7dce297ad8e7"
            ]
        ]
    },
    {
        "id": "cfc7631182b5ef67",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "check auth",
        "func": "\nif(msg.payload.length > 0){\n    msg.payload = msg.payload[0]\n    msg.user = {\n        auth: \"Success\",\n        code:200,\n        user: msg.payload\n    }\n    return [msg,null]\n}else{\n    msg.payload = {\n        auth: \"Unautorizate\",\n        code: 401,\n        login_id:msg.check.login_id,\n        app_id:msg.check.app_id\n    }\n    return [null,msg]\n}\n\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 860,
        "wires": [
            [
                "95ce8e1f931c2caa",
                "92a82d990292b9c2"
            ],
            [
                "b457f0b5c3fd5d96"
            ]
        ]
    },
    {
        "id": "e8da10b5c113d139",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 430,
        "y": 1000,
        "wires": []
    },
    {
        "id": "87b2820c2bf1143e",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1870,
        "y": 780,
        "wires": []
    },
    {
        "id": "21e68f3de4fa527b",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 290,
        "y": 1000,
        "wires": []
    },
    {
        "id": "c4baf76948a8dc38",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 850,
        "y": 820,
        "wires": []
    },
    {
        "id": "a602a24988dcc60f",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1870,
        "y": 820,
        "wires": []
    },
    {
        "id": "77f7fee169a929cd",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1050,
        "y": 60,
        "wires": []
    },
    {
        "id": "a1180b2b1b551c2c",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "err login",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1060,
        "y": 200,
        "wires": []
    },
    {
        "id": "6f81187c8d88e4de",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 660,
        "y": 120,
        "wires": [
            [
                "e594c405f087b6cf",
                "b42cb8e11e780105"
            ]
        ]
    },
    {
        "id": "1a6b5d862a0b4bfc",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 680,
        "y": 860,
        "wires": [
            [
                "cfc7631182b5ef67",
                "c4baf76948a8dc38"
            ]
        ]
    },
    {
        "id": "ca2dc46c7edc0fb2",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "links": [
            "b7c366424b9b7e6e"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1230,
        "y": 820,
        "wires": [
            [
                "2d9ec1b926f8fb35",
                "0cfa0691dcae508d"
            ]
        ]
    },
    {
        "id": "2d9ec1b926f8fb35",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "THIS",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1410,
        "y": 780,
        "wires": []
    },
    {
        "id": "1b7ab9bcbae8961f",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 330,
        "y": 80,
        "wires": []
    },
    {
        "id": "e49d1c22247329f1",
        "type": "http in",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "signout",
        "url": "/signout",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 90,
        "y": 320,
        "wires": [
            [
                "79c17e7d8ed1f939",
                "a4b43da2c7ab788f"
            ]
        ],
        "icon": "node-red/arrow-in.svg"
    },
    {
        "id": "be2ed7f861399f69",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "Checker",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 500,
        "y": 280,
        "wires": []
    },
    {
        "id": "962e2be5ddd19cfc",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 670,
        "y": 320,
        "wires": []
    },
    {
        "id": "a4b43da2c7ab788f",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "Checker",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 320,
        "y": 280,
        "wires": []
    },
    {
        "id": "79c17e7d8ed1f939",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "check jwt",
        "func": "msg.cookies={\n    user_token: null\n}\n\nmsg.payload={\n    success: true\n}\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 320,
        "wires": [
            [
                "be2ed7f861399f69",
                "c67252247235be7c"
            ]
        ]
    },
    {
        "id": "c67252247235be7c",
        "type": "delay",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 500,
        "y": 320,
        "wires": [
            [
                "962e2be5ddd19cfc"
            ]
        ]
    },
    {
        "id": "d8f65e08d1802e8e",
        "type": "delay",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "pauseType": "delay",
        "timeout": "4",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 480,
        "y": 120,
        "wires": [
            [
                "6f81187c8d88e4de",
                "7ad3662b16de3eaf"
            ]
        ]
    },
    {
        "id": "92a82d990292b9c2",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "get roles",
        "func": "msg.collection = \"admin_roles\"\nmsg.payload = [\n    {\n        $match:{\n            \"_id\": ObjectId(msg.payload.roles)\n        }\n    },\n    {\n        $lookup: {\n            from: 'translation',\n            as: 'translation',\n            pipeline: [\n                {\n                    $match: {\n                        deleted: false,\n                        language: msg.user.user.language\n                    }\n                }\n            ]\n        }\n    },\n    {\n        $lookup:\n        {\n            from: \"admin_modules\",\n            localField: \"permissions.moduleId\",\n            foreignField: \"_id\",\n            as: \"menu\"\n    }\n},\n]\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "ObjectId",
                "module": "objectid"
            }
        ],
        "x": 1040,
        "y": 820,
        "wires": [
            [
                "ca2dc46c7edc0fb2"
            ]
        ]
    },
    {
        "id": "95ce8e1f931c2caa",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1030,
        "y": 780,
        "wires": []
    },
    {
        "id": "b42cb8e11e780105",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "msg from db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 850,
        "y": 80,
        "wires": []
    },
    {
        "id": "9b40d9caf853741d",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "msg to db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 500,
        "y": 80,
        "wires": []
    },
    {
        "id": "7ad3662b16de3eaf",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "msg delay to db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 680,
        "y": 160,
        "wires": []
    },
    {
        "id": "e653dc9c2aa956f2",
        "type": "catch",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "g",
        "scope": [
            "92a82d990292b9c2"
        ],
        "uncaught": false,
        "x": 1470,
        "y": 900,
        "wires": [
            [
                "0b6ff6d92b1de7e7",
                "2a2d93b53c8a1966"
            ]
        ]
    },
    {
        "id": "0b6ff6d92b1de7e7",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "show err Unautorizate",
        "func": "msg.payload ={\n    auth: \"Unautorizate\",\n    code: 401,\n    login_id: msg.check.login_id,\n    }\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1660,
        "y": 900,
        "wires": [
            [
                "a602a24988dcc60f",
                "2a2d93b53c8a1966"
            ]
        ]
    },
    {
        "id": "2a2d93b53c8a1966",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1870,
        "y": 960,
        "wires": []
    },
    {
        "id": "26ad7dce297ad8e7",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "query to db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 670,
        "y": 820,
        "wires": []
    },
    {
        "id": "e26194f8f4aedcd3",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 310,
        "y": 420,
        "wires": []
    },
    {
        "id": "f2f94b0b491998e3",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "check ",
        "func": "const regexEmail = /^(([^<>()[\\]\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@(([^<>()[\\]\\.,;:\\s@\\\"]+\\.)+[^<>()[\\]\\.,;:\\s@\\\"]{2,})$/i;\nconst regexPassword = /^(?!.*\\s).{8,}/;\nconst email = msg.payload.email.toLowerCase();\n\nif (!regexEmail.test(email)) {\n    msg.statusCode = 401;\n    msg.payload = {\n        data: \"Email is invalid\",\n        code: 401\n    }\n\n    return [null, msg];\n\n} else if (!regexPassword.test(msg.payload.password)) {\n    msg.statusCode = 401;\n    msg.payload = {\n        data: \"The password is invalid. The value must be at least 8 characters and without whitespaces\",\n        code: 401\n    }\n\n    return [null, msg];\n\n} else {\n    msg.collection = \"admins\";\n    msg.oldpayload = msg.payload;\n\n    msg.payload = {\n        email: email,\n        deleted: false\n    };\n\n    return [msg, null];\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 460,
        "wires": [
            [
                "e4082ecde347ac24",
                "9ed90dc87878d5c1"
            ],
            [
                "82bf44e646ff81c1",
                "3d2a6611794a1aab"
            ]
        ]
    },
    {
        "id": "e4082ecde347ac24",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 480,
        "y": 460,
        "wires": [
            [
                "831f0bc99fde7925",
                "ccbf43ec2e0f83d7"
            ]
        ]
    },
    {
        "id": "9ed90dc87878d5c1",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "msg to db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 460,
        "y": 420,
        "wires": []
    },
    {
        "id": "831f0bc99fde7925",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "check",
        "func": "if (msg.payload.length > 0) {\n    if (!msg.payload[0].active) {\n        const decoded = jwt.verify(msg.payload[0].verifyToken, 'test');\n        const dateNow = new Date().getTime();\n\n        if (decoded.exp < dateNow) {\n            msg.query = { _id: objectid(msg.payload[0]._id) }\n            msg.payload = {\n                $set: {\n                    deleted: false\n                }\n            }\n\n            return [null, null, msg, null]\n        } else {\n            msg.payload = {\n                verifyToken: msg.payload[0].verifyToken,\n                email: msg.payload[0].email\n            }\n\n            return [null, null, null, msg]\n        }\n    } else {\n        msg.payload = {\n            data: \"This email address already exists\",\n            code: 400,\n        }\n        return [null, msg, null, null]\n    }\n}\nelse {\n    return [msg, null, null, null]\n}\n\n\n",
        "outputs": 4,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "jwt",
                "module": "jsonwebtoken"
            },
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 650,
        "y": 460,
        "wires": [
            [
                "376f7da2f0d85f32",
                "be700872e8a93107"
            ],
            [
                "9da58b8ba7897ee6",
                "a7f063573564d610"
            ],
            [
                "6012ab98a19cbb6a"
            ],
            [
                "eed04ab51fe181f6"
            ]
        ]
    },
    {
        "id": "376f7da2f0d85f32",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "registration user",
        "func": "let randomColor = \"#\" + Math.floor(Math.random() * 16777215).toString(16);\nlet encryptedPassword = await bcrypt.hash(msg.oldpayload.password, 10);\nconst verifyToken = await jwt.sign(\n    { id: Math.round(Math.random()) },\n    \"test\",\n    {\n        expiresIn: \"150m\",\n    }\n);\n\nmsg.cookies = {};\nmsg.cookies[\"verify_token\"] = verifyToken;\nmsg.cookies[\"email_register\"] = msg.oldpayload.email;\n\nmsg.payload = {\n    \"_id\": objectid(),\n    \"deleted\": false,\n    \"avatarColor\": randomColor,\n    \"createdAt\": new Date(),\n    \"roles\": [objectid(\"6566035c962bbb0011349ba9\")],\n    \"active\": false,\n    \"firstname\": msg.oldpayload.firstname,\n    \"lastname\": msg.oldpayload.lastname,\n    \"email\": msg.oldpayload.email.toLowerCase(),\n    \"password\": encryptedPassword,\n    verifyToken,\n    resetPassToken: \"\",\n    resetPassExpireToken: null\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            },
            {
                "var": "bcrypt",
                "module": "bcrypt"
            },
            {
                "var": "jwt",
                "module": "jsonwebtoken"
            }
        ],
        "x": 1040,
        "y": 400,
        "wires": [
            [
                "eed04ab51fe181f6",
                "6197204f97d99e26",
                "bb1864602327c1ca"
            ]
        ]
    },
    {
        "id": "9da58b8ba7897ee6",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "statusCode": "400",
        "headers": {},
        "x": 860,
        "y": 440,
        "wires": []
    },
    {
        "id": "a7f063573564d610",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "err when created user",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 920,
        "y": 340,
        "wires": []
    },
    {
        "id": "be700872e8a93107",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 850,
        "y": 380,
        "wires": []
    },
    {
        "id": "bb1864602327c1ca",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "links": [
            "1764f8568a80ddbd"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1230,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "eed04ab51fe181f6",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "msg to email",
        "func": "const token = msg.payload.verifyToken;\nconst nodeUrl = env.get(\"nodeUrl\");\nconst url = `${nodeUrl}/verifyToken?token=${token}`;\nconst text = `\n<div style=\"padding: 10px 0; color: black;\">\n    <h1>Confirm Your Email Address</h1>\n    <p>Tap the button below to confirm your email address. If you didn't create an account, you can delete this email.</p>\n    <a href=\"${url}\" target=\"_blank\" style=\"margin: 10px 0; display: inline-block; padding: 16px 36px; font-family: 'Source Sans Pro', Helvetica, Arial, sans-serif; font-size: 16px; color: #ffffff; text-decoration: none; border-radius: 6px; background: #95e4f0;\">Confirm</a>\n</div>\n`;\n\nmsg.to = msg.payload.email;\nmsg.topic = 'Verify';\nmsg.payload = text;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "jwt",
                "module": "jsonwebtoken"
            }
        ],
        "x": 1010,
        "y": 560,
        "wires": [
            [
                "8c18463582ac198c",
                "406b08af64a38632",
                "862f69abf4db399d"
            ]
        ]
    },
    {
        "id": "6197204f97d99e26",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1210,
        "y": 400,
        "wires": []
    },
    {
        "id": "8c18463582ac198c",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "msg to email",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1210,
        "y": 520,
        "wires": []
    },
    {
        "id": "406b08af64a38632",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1190,
        "y": 600,
        "wires": []
    },
    {
        "id": "46d2feb29eb7f617",
        "type": "http in",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "repeatRegisterEmail",
        "url": "/repeatRegisterEmail",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 130,
        "y": 660,
        "wires": [
            [
                "ba0fdb3c55f49767",
                "3b0fca787d0682d1"
            ]
        ],
        "icon": "node-red/arrow-in.svg"
    },
    {
        "id": "ba0fdb3c55f49767",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "email and token",
        "func": "msg.payload = {\n    verifyToken: msg.req.cookies.verify_token,\n    email: msg.req.cookies.email_register.toLowerCase()\n}\nmsg.email = msg.req.cookies.email_register.toLowerCase();\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 660,
        "wires": [
            [
                "f833e1216c97cff7",
                "32fb51525caa70d8"
            ]
        ]
    },
    {
        "id": "3b0fca787d0682d1",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "came",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 350,
        "y": 700,
        "wires": []
    },
    {
        "id": "99544f5cb03a9f23",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 910,
        "y": 700,
        "wires": []
    },
    {
        "id": "32fb51525caa70d8",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "msg to email",
        "func": "const token = msg.payload.verifyToken;\nconst nodeUrl = env.get(\"nodeUrl\");\nconst url = `${nodeUrl}/verifyToken?token=${token}`;\nconst text = `\n<div style=\"padding: 10px 0; color: black;\">\n    <h1>Confirm Your Email Address</h1>\n    <p>Tap the button below to confirm your email address. If you didn't create an account, you can delete this email.</p>\n    <a href=\"${url}\" target=\"_blank\" style=\"margin: 10px 0; display: inline-block; padding: 16px 36px; font-family: 'Source Sans Pro', Helvetica, Arial, sans-serif; font-size: 16px; color: #ffffff; text-decoration: none; border-radius: 6px; background: #95e4f0;\">Confirm</a>\n</div>\n`;\n\nmsg.to = msg.payload.email;\nmsg.topic = 'Verify';\nmsg.payload = text;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "jwt",
                "module": "jsonwebtoken"
            }
        ],
        "x": 570,
        "y": 660,
        "wires": [
            [
                "c193a98b11e16770",
                "d2dc6d60f2aadf80",
                "e9e5b74b5109f5de"
            ]
        ]
    },
    {
        "id": "c193a98b11e16770",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "repeat msg to email",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 770,
        "y": 620,
        "wires": []
    },
    {
        "id": "f833e1216c97cff7",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "payload",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 560,
        "y": 620,
        "wires": []
    },
    {
        "id": "d2dc6d60f2aadf80",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "msg to page",
        "func": "msg.payload = {\n    data: `We sent the email \"${msg.email}\" again. Please, check your inbox or spam.`\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 700,
        "wires": [
            [
                "99544f5cb03a9f23",
                "62ac94f341138925"
            ]
        ]
    },
    {
        "id": "62ac94f341138925",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "finish",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 910,
        "y": 660,
        "wires": []
    },
    {
        "id": "6d762311464829e7",
        "type": "http in",
        "z": "c8b39bad946d8ab6",
        "g": "2229ae9934019399",
        "name": "verifyToken",
        "url": "/verifyToken",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 870,
        "y": 1200,
        "wires": [
            [
                "13e4e31799cdc417",
                "9ef904e08c1b1ac1"
            ]
        ]
    },
    {
        "id": "9a785ddcdaf6df0d",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "2229ae9934019399",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1610,
        "y": 1200,
        "wires": []
    },
    {
        "id": "9ef904e08c1b1ac1",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "2229ae9934019399",
        "name": "query to db",
        "func": "msg.collection = \"admins\";\nmsg.cameToken = msg.payload.token;\n\nmsg.payload = {\n    verifyToken: msg.payload.token\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1070,
        "y": 1200,
        "wires": [
            [
                "19089ad57199af39",
                "85976ad92833929a"
            ]
        ]
    },
    {
        "id": "13e4e31799cdc417",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "2229ae9934019399",
        "name": "came",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1070,
        "y": 1160,
        "wires": []
    },
    {
        "id": "b4488590d344582f",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "2229ae9934019399",
        "name": "finish",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1630,
        "y": 1160,
        "wires": []
    },
    {
        "id": "19089ad57199af39",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "2229ae9934019399",
        "name": "query to db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1250,
        "y": 1160,
        "wires": []
    },
    {
        "id": "5fe531e8c9bf55b6",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "2229ae9934019399",
        "name": "res db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1430,
        "y": 1160,
        "wires": []
    },
    {
        "id": "636a9bb0cdc28a94",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "2229ae9934019399",
        "name": "redirect to page",
        "func": "node.warn(msg)\nconst token = await jwt.sign(\n    { user_id: msg.payload[0]._id, email: msg.payload[0].email },\n    \"test\",\n    {\n        expiresIn: \"150m\",\n    }\n);\n\nconst uiUrl = env.get(\"uiUrl\");\n\nmsg.token = token\nmsg.statusCode = 302\nmsg.headers = {\n    \"Access-Control-Allow-Origin\": \"*\",\n    \"Access-Control-Allow-Credentials\": true,\n    \"location\": `${uiUrl}/Login`\n}\n\nmsg.collection = \"admins\";\nmsg.query = {\n    _id: objectid(msg.payload[0]._id)\n}\nmsg.payload = {\n    $set: {\n        active: true,\n        verifyToken: null\n    }\n}\n\nnode.send(msg)",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "jwt",
                "module": "jsonwebtoken"
            },
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 1440,
        "y": 1200,
        "wires": [
            [
                "9a785ddcdaf6df0d",
                "b4488590d344582f",
                "a2b1bc579a4c0ced"
            ]
        ]
    },
    {
        "id": "85976ad92833929a",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "2229ae9934019399",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1270,
        "y": 1200,
        "wires": [
            [
                "636a9bb0cdc28a94",
                "5fe531e8c9bf55b6"
            ]
        ]
    },
    {
        "id": "a2b1bc579a4c0ced",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "2229ae9934019399",
        "name": "",
        "links": [
            "286431cd31c9fc7a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1660,
        "y": 1240,
        "wires": [
            []
        ]
    },
    {
        "id": "03b23aac01f7893f",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "came",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 330,
        "y": 2460,
        "wires": []
    },
    {
        "id": "411b69c681820b0e",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "\"deleted\": true",
        "func": "msg.collection = \"admin_modules\";\n\nmsg.query = {\n    \"_id\": objectid(msg.payload._id)\n};\n\nmsg.payload = {\n    $set: {\n        deleted: true\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 360,
        "y": 2500,
        "wires": [
            [
                "cd5c1d01d15467f7",
                "81bdba71023d5429"
            ]
        ]
    },
    {
        "id": "500861a5b5623bc5",
        "type": "http in",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "",
        "url": "/deleteModule",
        "method": "delete",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 2520,
        "wires": [
            [
                "411b69c681820b0e",
                "3000e64189b3ff39",
                "03b23aac01f7893f",
                "6d5c9e567735125f"
            ]
        ]
    },
    {
        "id": "cd5c1d01d15467f7",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "finsih parent delete",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 910,
        "y": 2500,
        "wires": []
    },
    {
        "id": "81bdba71023d5429",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "",
        "links": [
            "286431cd31c9fc7a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 560,
        "y": 2500,
        "wires": [
            [
                "cd5c1d01d15467f7"
            ]
        ]
    },
    {
        "id": "3000e64189b3ff39",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "delete using pull",
        "func": "msg.collection = \"admin_roles\"\n\nmsg.query = {\n    \"permissions.moduleId\": objectid(msg.payload._id)\n}\n\nmsg.payload =\n    { $pull: { \"permissions\": { \"moduleId\": objectid(msg.payload._id) } } }\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 360,
        "y": 2540,
        "wires": [
            [
                "943cda0940fbfc65",
                "0d8e4b5e24ee7f2c"
            ]
        ]
    },
    {
        "id": "943cda0940fbfc65",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "finish childs delete",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 910,
        "y": 2540,
        "wires": []
    },
    {
        "id": "6d5c9e567735125f",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 730,
        "y": 2520,
        "wires": []
    },
    {
        "id": "0d8e4b5e24ee7f2c",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "",
        "links": [
            "286431cd31c9fc7a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 560,
        "y": 2540,
        "wires": [
            [
                "943cda0940fbfc65"
            ]
        ]
    },
    {
        "id": "080f87898258c1e5",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "update roles",
        "func": "msg.collection = \"admin_roles\";\n\nmsg.query = {\n    \"permissions.moduleId\": objectid(msg.payload._id)\n    }\n\nmsg.payload = {\n    $set: {\n        \"permissions.$.module\": msg.payload.name\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 330,
        "y": 2340,
        "wires": [
            [
                "acef5e4ee852a34b",
                "920e683749d9b015"
            ]
        ]
    },
    {
        "id": "3835bedd5b59284c",
        "type": "http in",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "updateParentModule",
        "url": "/updateParentModule",
        "method": "put",
        "upload": false,
        "swaggerDoc": "",
        "x": 130,
        "y": 2360,
        "wires": [
            [
                "ae293692fead8475",
                "080f87898258c1e5",
                "7001dd6d6d4622d6"
            ]
        ],
        "icon": "font-awesome/fa-edit"
    },
    {
        "id": "acef5e4ee852a34b",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "finish",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 830,
        "y": 2340,
        "wires": []
    },
    {
        "id": "920e683749d9b015",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "",
        "links": [
            "286431cd31c9fc7a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 520,
        "y": 2340,
        "wires": [
            []
        ]
    },
    {
        "id": "7001dd6d6d4622d6",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 710,
        "y": 2360,
        "wires": []
    },
    {
        "id": "ae293692fead8475",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "update parent",
        "func": "msg.collection = \"admin_modules\";\n\nmsg.query = {\n    _id: objectid(msg.payload._id)\n};\n\nmsg.payload = {\n    $set: {\n        icon: msg.payload.icon,\n        position: msg.payload.position,\n        name: msg.payload.name\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 340,
        "y": 2380,
        "wires": [
            [
                "732470b6749e6a6e",
                "84af4b543dc711ed"
            ]
        ]
    },
    {
        "id": "732470b6749e6a6e",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "",
        "links": [
            "286431cd31c9fc7a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 540,
        "y": 2380,
        "wires": [
            []
        ]
    },
    {
        "id": "84af4b543dc711ed",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "a8bcf74ef7690d27",
        "name": "finish",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 850,
        "y": 2380,
        "wires": []
    },
    {
        "id": "769c853fb108cedb",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 470,
        "y": 160,
        "wires": []
    },
    {
        "id": "53cd8649fa65084f",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "name": "err login",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 480,
        "y": 200,
        "wires": []
    },
    {
        "id": "82bf44e646ff81c1",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 450,
        "y": 500,
        "wires": []
    },
    {
        "id": "3d2a6611794a1aab",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "name": "err register",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 470,
        "y": 540,
        "wires": []
    },
    {
        "id": "5164464dd17d2bc2",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1370,
        "y": 1500,
        "wires": []
    },
    {
        "id": "c08229195cce1b53",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "name": "err register",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1390,
        "y": 1540,
        "wires": []
    },
    {
        "id": "6012ab98a19cbb6a",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "links": [
            "286431cd31c9fc7a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 880,
        "y": 480,
        "wires": [
            [
                "376f7da2f0d85f32"
            ]
        ]
    },
    {
        "id": "0cfa0691dcae508d",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "name": "menu grouping",
        "func": "msg.payload = msg.payload[0];\nmsg.permissions = msg.payload.permissions;\n\nfunction sortByPositionNumber(arr) {\n    return arr.sort((a, b) => +a.position - +b.position);\n}\n\nmsg.menu = sortByPositionNumber(msg.payload.menu).map(el => {\n\n    if (el.isParent) {\n        return {\n            \"label\": el.name,\n            \"value\": el.name,\n            \"icon\": el.icon ? el.icon : \"\",\n            \"children\": el.childModules.length \n                ? sortByPositionNumber(el.childModules)\n                  .map(item => ({\n                      \"label\": item.name,\n                      \"value\": item.name,\n                      \"icon\": item.icon ? item.icon : \"\"\n                  })) \n                : []\n        }\n    } else {\n        return {\n            \"label\": el.name,\n            \"value\": el.name,\n            \"children\": [],\n            \"icon\": el.icon ? el.icon : \"\",\n        }\n    }\n    \n});\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1440,
        "y": 820,
        "wires": [
            [
                "14cc1d46a9f6856f",
                "6f874c3f5f2d8c7e"
            ]
        ]
    },
    {
        "id": "14cc1d46a9f6856f",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "name": "check user permissions",
        "func": "const pageName = msg.check.page_id.replace('%20', ' ');\n\nconst parentPage = msg.menu.map((el) => el.label).includes(pageName);\nconst childPage = msg.menu.filter((e) => e.children.length > 0).flatMap((el) => el.children).map((elem) => elem.label).includes(pageName);\n\nif (parentPage || childPage) {\n\n    msg.statusCode = 200;\n    msg.payload = {\n        auth: \"Success\",\n        code: 200,\n        user: {\n            \"menu\": msg.menu,\n            \"permission\": msg.permissions,\n            \"translation\": msg.payload.translation[0],\n            \"info\": msg.user\n        }\n    }\n\n} else {\n\n    msg.payload = {\n        auth: \"Unautorizate\",\n        code: 401,\n        login_id: msg.menu[0].value + `?pageName=${msg.menu[0].value}`,\n        app_id: msg.check.app_id\n    }\n\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1670,
        "y": 820,
        "wires": [
            [
                "87b2820c2bf1143e",
                "a602a24988dcc60f"
            ]
        ]
    },
    {
        "id": "6f874c3f5f2d8c7e",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "name": "menu grouping",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1640,
        "y": 780,
        "wires": []
    },
    {
        "id": "c156d588bb3ba207",
        "type": "e-mail",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "server": "smtp.gmail.com",
        "port": "465",
        "secure": true,
        "tls": true,
        "name": "",
        "dname": "",
        "x": 1590,
        "y": 420,
        "wires": []
    },
    {
        "id": "bd903ea2c5d6bd1c",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "3b2ecc05f3cef5f7",
        "name": "all users",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 500,
        "y": 3060,
        "wires": []
    },
    {
        "id": "e69809f9f1b11215",
        "type": "link in",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "sendMail",
        "links": [],
        "x": 1445,
        "y": 420,
        "wires": [
            [
                "c156d588bb3ba207"
            ]
        ]
    },
    {
        "id": "862f69abf4db399d",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "links": [
            "e69809f9f1b11215"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1260,
        "y": 560,
        "wires": [
            []
        ]
    },
    {
        "id": "e9e5b74b5109f5de",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "d78377c07a215120",
        "name": "",
        "links": [
            "e69809f9f1b11215"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 740,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "970bf1d3e8383bba",
        "type": "http in",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "queryToResetPassword",
        "url": "/queryToResetPassword",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 900,
        "y": 1640,
        "wires": [
            [
                "c823a259da378156",
                "2082fa66df328468"
            ]
        ]
    },
    {
        "id": "c823a259da378156",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "came",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1130,
        "y": 1600,
        "wires": []
    },
    {
        "id": "2082fa66df328468",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "query to db",
        "func": "msg.collection = \"admins\";\nmsg.token = msg.payload.token;\n\nmsg.payload = {\n    resetPassToken: msg.payload.token\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1150,
        "y": 1640,
        "wires": [
            [
                "3b262e8c754b5f29",
                "bdbcc19d02a07b56"
            ]
        ]
    },
    {
        "id": "3b262e8c754b5f29",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "query to db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1330,
        "y": 1600,
        "wires": []
    },
    {
        "id": "bdbcc19d02a07b56",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1340,
        "y": 1640,
        "wires": [
            [
                "9c78085fd79972cb",
                "2eda0c91d0b75786"
            ]
        ]
    },
    {
        "id": "9c78085fd79972cb",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "redirect to page",
        "func": "const dateNow = new Date().getTime();\nconst uiUrl = env.get(\"uiUrl\");\n\nif (msg.payload[0].resetPassExpireToken > dateNow) {\n    msg.statusCode = 302\n    msg.headers = {\n        \"Access-Control-Allow-Origin\": \"*\",\n        \"Access-Control-Allow-Credentials\": true,\n        \"location\": `${uiUrl}/ResetPassword?token=${msg.token}`\n    }\n} else {\n    msg.payload = '<h1>Link expired</h1>';\n};\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "jwt",
                "module": "jsonwebtoken"
            },
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 1520,
        "y": 1640,
        "wires": [
            [
                "2687dc71562c4d72",
                "f1f861b64944b804"
            ]
        ]
    },
    {
        "id": "2eda0c91d0b75786",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "res db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1510,
        "y": 1600,
        "wires": []
    },
    {
        "id": "2687dc71562c4d72",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1690,
        "y": 1640,
        "wires": []
    },
    {
        "id": "f1f861b64944b804",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "finish queryToResetPassword",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1770,
        "y": 1600,
        "wires": []
    },
    {
        "id": "d09ec9996f8a154c",
        "type": "http in",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "sendEmailForResetPassword",
        "url": "/sendEmailForResetPassword",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 920,
        "y": 1460,
        "wires": [
            [
                "17248297231b9d88",
                "d8e9faa5f5797221"
            ]
        ],
        "icon": "node-red/arrow-in.svg"
    },
    {
        "id": "17248297231b9d88",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "query to db",
        "func": "const regexEmail = /^(([^<>()[\\]\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@(([^<>()[\\]\\.,;:\\s@\\\"]+\\.)+[^<>()[\\]\\.,;:\\s@\\\"]{2,})$/i;\nconst email = msg.payload.email.toLowerCase();\n\nif (!regexEmail.test(email)) {\n\n    msg.statusCode = 401;\n    msg.payload = {\n        data: \"Email is invalid\",\n        code: 401\n    }\n\n    return [null, msg];\n\n} else {\n    msg.collection = \"admins\";\n\n    msg.email = msg.payload.email;\n\n    msg.payload = {\n        email: email,\n        deleted: false\n    }\n\n    return [msg, null];\n} \n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1190,
        "y": 1460,
        "wires": [
            [
                "59a6366d8be0ed5e"
            ],
            [
                "5164464dd17d2bc2",
                "c08229195cce1b53"
            ]
        ]
    },
    {
        "id": "d8e9faa5f5797221",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "came",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1170,
        "y": 1420,
        "wires": []
    },
    {
        "id": "59a6366d8be0ed5e",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1380,
        "y": 1460,
        "wires": [
            [
                "a605c9337c4c16d3",
                "ed02bf967732b00f"
            ]
        ]
    },
    {
        "id": "a605c9337c4c16d3",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "send response",
        "func": "if (msg.payload.length === 0){\n    msg.statusCode = 401;\n\n    msg.payload = {\n        data: \"Forbidden! Incorrect email.\",\n        code: 401\n    }\n    return [null, msg]\n}\n\nmsg.payload = msg.payload[0];\n    \nreturn[msg, null]\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1560,
        "y": 1460,
        "wires": [
            [
                "a92c36a6ee2e65ce",
                "97dc27c464c28717"
            ],
            [
                "4f97e46839f52868",
                "d52f6d33dbea5a1b"
            ]
        ]
    },
    {
        "id": "ed02bf967732b00f",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "Item after DB",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1550,
        "y": 1420,
        "wires": []
    },
    {
        "id": "a92c36a6ee2e65ce",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "item",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1730,
        "y": 1400,
        "wires": []
    },
    {
        "id": "97dc27c464c28717",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "query to db",
        "func": "// Add 30 minutes\nconst date = new Date();\nconst expireTime = date.setMinutes(date.getMinutes() + 30);\nconst token = crypto.randomBytes(64).toString('hex');\n\nmsg.oldpayload = msg.payload;\nmsg.token = token;\n\nmsg.cookies = {};\nmsg.cookies[\"user_email\"] = msg.email;\n\nmsg.collection = \"admins\";\nmsg.query = {\n    _id: objectid(msg.payload._id)\n}\nmsg.payload = {\n    $set: {\n        resetPassToken: token,\n        resetPassExpireToken: expireTime\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            },
            {
                "var": "crypto",
                "module": "crypto"
            }
        ],
        "x": 1750,
        "y": 1440,
        "wires": [
            [
                "8eb1eca7b6974e66",
                "ddf35fbb3e263951",
                "0d5a011ed0707629"
            ]
        ]
    },
    {
        "id": "4f97e46839f52868",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1730,
        "y": 1480,
        "wires": []
    },
    {
        "id": "d52f6d33dbea5a1b",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "err email not found",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1770,
        "y": 1520,
        "wires": []
    },
    {
        "id": "8eb1eca7b6974e66",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "query to db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1930,
        "y": 1360,
        "wires": []
    },
    {
        "id": "ddf35fbb3e263951",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "msg to email",
        "func": "const nodeUrl = env.get(\"nodeUrl\");\nconst url = `${nodeUrl}/queryToResetPassword?token=${msg.token}`;\n\nconst text = `\n<div style=\"padding: 10px 0; color: black;\">\n    <h1>We received a request to reset your password</h1>\n    <p>Use the link below to set up a new password for your account. If you did not request to reset your password, ignore this email and the link will expire on its own.</p>\n    <a href=\"${url}\" target=\"_blank\" style=\"margin: 10px 0; display: inline-block; padding: 16px 36px; font-family: 'Source Sans Pro', Helvetica, Arial, sans-serif; font-size: 16px; color: #ffffff; text-decoration: none; border-radius: 6px; background: #2E3D49;\">\n        SET NEW PASSWORD\n    </a>\n</div>\n`;\n\nmsg.to = msg.oldpayload.email;\nmsg.topic = 'Reset password';\nmsg.payload = text;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "jwt",
                "module": "jsonwebtoken"
            }
        ],
        "x": 1930,
        "y": 1440,
        "wires": [
            [
                "2212b62e77474999",
                "d32809a33993ab1c",
                "2fb7515b09f5d74a"
            ]
        ]
    },
    {
        "id": "0d5a011ed0707629",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "",
        "links": [
            "286431cd31c9fc7a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1960,
        "y": 1400,
        "wires": [
            []
        ]
    },
    {
        "id": "2212b62e77474999",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 2150,
        "y": 1480,
        "wires": []
    },
    {
        "id": "d32809a33993ab1c",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "finish sendEmailForResetPassword",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2240,
        "y": 1400,
        "wires": []
    },
    {
        "id": "6730dfa61287b9f2",
        "type": "http in",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "resetPassword",
        "url": "/resetPassword",
        "method": "put",
        "upload": false,
        "swaggerDoc": "",
        "x": 880,
        "y": 1840,
        "wires": [
            [
                "19690b9c050dd6f9",
                "a2eb69e6ad5db371"
            ]
        ],
        "icon": "font-awesome/fa-edit"
    },
    {
        "id": "19690b9c050dd6f9",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "came resetPassword",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1120,
        "y": 1800,
        "wires": []
    },
    {
        "id": "a2eb69e6ad5db371",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "query to db",
        "func": "msg.newPassword = msg.payload.password;\n\nmsg.collection = \"admins\";\nmsg.payload = {\n    resetPassToken: msg.payload.token\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1090,
        "y": 1840,
        "wires": [
            [
                "80ae78b49345f62c"
            ]
        ]
    },
    {
        "id": "80ae78b49345f62c",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1270,
        "y": 1840,
        "wires": [
            [
                "9fe3a92c904e973d",
                "654fcb097eed7e68"
            ]
        ]
    },
    {
        "id": "654fcb097eed7e68",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "query update pass",
        "func": "const dateNow = new Date().getTime();\nlet check = await bcrypt.compare(msg.newPassword, msg.payload[0].password);\nlet encryptedPassword = await bcrypt.hash(msg.newPassword, 10);\n\nmsg.oldpayload = msg.payload;\n\nif (msg.payload[0].resetPassExpireToken < dateNow) {\n\n    msg.payload = '<h1>link expired</h1>';\n\n} else {\n\n    if (!!check) {\n\n        msg.statusCode = 401;\n        msg.payload = {\n            data: 'The password must be different from the previous one',\n            code: 401\n        }\n\n        return [null, msg];\n\n    } else {\n        \n        msg.collection = \"admins\";\n        msg.query = {\n            _id: objectid(msg.payload[0]._id)\n        }\n        msg.payload = {\n            $set: {\n                password: encryptedPassword,\n                resetPassToken: \"\",\n                resetPassExpireToken: null\n            }\n        }\n        \n        return [msg, null];\n\n    }\n\n}\n\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "jwt",
                "module": "jsonwebtoken"
            },
            {
                "var": "objectid",
                "module": "objectid"
            },
            {
                "var": "bcrypt",
                "module": "bcrypt"
            }
        ],
        "x": 1470,
        "y": 1840,
        "wires": [
            [
                "71ea35313c1e5bbe",
                "d12866b139615b07",
                "45455fa4faeda4c6"
            ],
            [
                "7df30165a4d0a7eb"
            ]
        ]
    },
    {
        "id": "9fe3a92c904e973d",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "res db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1430,
        "y": 1800,
        "wires": []
    },
    {
        "id": "71ea35313c1e5bbe",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "query to db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1670,
        "y": 1760,
        "wires": []
    },
    {
        "id": "d12866b139615b07",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "msg to email",
        "func": "const uiUrl = env.get(\"uiUrl\");\nconst url = `${uiUrl}/Login`;\nconst dateChanged = new Date().toString().slice(0, 24);\nconst text = `\n<div style=\"padding: 10px 0; color: black;\" display: block;>\n    <img src=\"https://www.iconpacks.net/icons/2/free-icon-check-mark-3280.png\"; alt=\"Success Icon\"; width=90px; height=90px;>\n    <h1 text-align=\"center\" >Password changed!</h1>\n    <p>\n        Your password has been changed successfully. \n        This is a confirmation that your password was changed at <b>${dateChanged}</b>\n        <br><br>\n        Use your new password to log in.\n    </p>\n    <a href=\"${url}\" target=\"_blank\" style=\"margin: 10px 0; display: inline-block; padding: 16px 36px; font-family: 'Source Sans Pro', Helvetica, Arial, sans-serif; font-size: 16px; color: #ffffff; text-decoration: none; border-radius: 6px; background: #72D393;\">\n        <b>LOGIN NOW</b>\n    </a>\n</div>\n`;\n\nmsg.to = msg.oldpayload[0].email;\nmsg.topic = 'Password changed';\nmsg.payload = text;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "jwt",
                "module": "jsonwebtoken"
            }
        ],
        "x": 1670,
        "y": 1840,
        "wires": [
            [
                "c4d39042ddfb3c4c",
                "ca0b1f9a3c42aad6",
                "df7f03d335a3ce5b"
            ]
        ]
    },
    {
        "id": "45455fa4faeda4c6",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "",
        "links": [
            "286431cd31c9fc7a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1680,
        "y": 1800,
        "wires": [
            []
        ]
    },
    {
        "id": "c4d39042ddfb3c4c",
        "type": "debug",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "finish sendEmailForResetPassword",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1960,
        "y": 1760,
        "wires": []
    },
    {
        "id": "ca0b1f9a3c42aad6",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1870,
        "y": 1840,
        "wires": []
    },
    {
        "id": "7df30165a4d0a7eb",
        "type": "function",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "same pasword",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1680,
        "y": 1900,
        "wires": [
            [
                "36a8ed88d4ee5217"
            ]
        ]
    },
    {
        "id": "36a8ed88d4ee5217",
        "type": "http response",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1850,
        "y": 1900,
        "wires": []
    },
    {
        "id": "2fb7515b09f5d74a",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "",
        "links": [
            "e69809f9f1b11215"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 2280,
        "y": 1440,
        "wires": [
            []
        ]
    },
    {
        "id": "df7f03d335a3ce5b",
        "type": "link call",
        "z": "c8b39bad946d8ab6",
        "g": "5bf7ccb6c6709633",
        "name": "",
        "links": [
            "e69809f9f1b11215"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1880,
        "y": 1800,
        "wires": [
            []
        ]
    },
    {
        "id": "99f22ab68403d04f",
        "type": "inject",
        "z": "2d9205901ae51ca8",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "60",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 640,
        "wires": [
            [
                "a56ea1c4d9c1daad"
            ]
        ]
    },
    {
        "id": "a56ea1c4d9c1daad",
        "type": "function",
        "z": "2d9205901ae51ca8",
        "name": "function 3",
        "func": "let process_env = {\n    WOOCOMMERCE_CONSUMER_SECRET_WORKER: \"cs_67de52075be981454d7d7a52297bc11b85b482f0\",\n    BASE_URL: \"https://worker.wf.tadiranforce.co.il/wp-json/wc/v3/\",\n    WOOCOMMERCE_CONSUMER_KEY_WORKER: \"ck_a933ca8652a19899ba69040f006b8beb092392f9\",\n}\n\n// process_env.WOOCOMMERCE_CONSUMER_KEY_WORKER}:${\n//     process_env.WOOCOMMERCE_CONSUMER_SECRET_WORKER\nglobal.set(\"process_env\", process_env)\nreturn msg;\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 640,
        "wires": [
            []
        ]
    },
    {
        "id": "4441ee4978cd8588",
        "type": "subflow:95370d1e369768c7",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "",
        "x": 700,
        "y": 220,
        "wires": [
            [
                "8a5f8c42e08af4a4"
            ],
            [
                "d64fca651f36b449"
            ]
        ]
    },
    {
        "id": "99fbe13dd59a33fc",
        "type": "http in",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "",
        "url": "/updateCategory",
        "method": "put",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 220,
        "wires": [
            [
                "5bf54fc5c3c30d7e",
                "15df488e0f2db9c1"
            ]
        ]
    },
    {
        "id": "72508a7c03713f9b",
        "type": "http in",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "",
        "url": "/createCategory",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 80,
        "wires": [
            [
                "d1c918821bb50c6a"
            ]
        ]
    },
    {
        "id": "2c921fabc757fcf0",
        "type": "http in",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "",
        "url": "/getCategories",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 130,
        "y": 280,
        "wires": [
            [
                "49c30689feaa8461"
            ]
        ]
    },
    {
        "id": "72bf5cf7c2ccfe10",
        "type": "http in",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "",
        "url": "/getCategory",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 130,
        "y": 160,
        "wires": [
            [
                "17d84524f816985e"
            ]
        ]
    },
    {
        "id": "e2959056e055babf",
        "type": "link call",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "",
        "links": [
            "1764f8568a80ddbd"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1170,
        "y": 60,
        "wires": [
            [
                "f4a7ffaa1fe9daa3"
            ]
        ]
    },
    {
        "id": "e9dd09ddd43cc418",
        "type": "link call",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 530,
        "y": 280,
        "wires": [
            [
                "853eb1a668ed5d52"
            ]
        ]
    },
    {
        "id": "853eb1a668ed5d52",
        "type": "http response",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 670,
        "y": 280,
        "wires": []
    },
    {
        "id": "e99cd1a49f29f041",
        "type": "http response",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 670,
        "y": 160,
        "wires": []
    },
    {
        "id": "1662e0c4bb1b6964",
        "type": "link call",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "",
        "links": [
            "286431cd31c9fc7a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1180,
        "y": 200,
        "wires": [
            [
                "70a23afb33828b3f"
            ]
        ]
    },
    {
        "id": "70a23afb33828b3f",
        "type": "http response",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1330,
        "y": 200,
        "wires": []
    },
    {
        "id": "6c9691cfca401519",
        "type": "http in",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "",
        "url": "/deleteCategory",
        "method": "delete",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 500,
        "wires": [
            [
                "13bebcef94ddb1a1"
            ]
        ]
    },
    {
        "id": "b8bbb554f7193525",
        "type": "link call",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "",
        "links": [
            "286431cd31c9fc7a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1500,
        "y": 480,
        "wires": [
            [
                "413e0304929b65e9"
            ]
        ]
    },
    {
        "id": "413e0304929b65e9",
        "type": "http response",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1670,
        "y": 480,
        "wires": []
    },
    {
        "id": "d1c918821bb50c6a",
        "type": "function",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "create",
        "func": "msg.collection = \"categories\"\nmsg.method  = \"POST\"\nmsg.endpoint = \"products/categories\"\nmsg.payload = {\n    ...msg.payload,\n    deleted: false,\n    _id: objectid(),\n}\nmsg.fromApp = msg.payload\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 350,
        "y": 80,
        "wires": [
            [
                "084e03545305bcab"
            ]
        ]
    },
    {
        "id": "49c30689feaa8461",
        "type": "function",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "find",
        "func": "msg.collection = \"categories\";\nif(msg.payload.q){\n    msg.payload = {\n        $and: [\n            {\n                $or: [\n                    { \"name\": { $regex: msg.payload.q, $options: \"i\" } },\n                    { \"description\": { $regex: msg.payload.q, $options: \"i\" } }\n                ]\n            },\n            { deleted: false }\n        ]\n    };\n}else{\n    msg.payload = {\n        deleted: false\n    }\n}\ndelete msg.payload.q\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 280,
        "wires": [
            [
                "e9dd09ddd43cc418"
            ]
        ]
    },
    {
        "id": "17d84524f816985e",
        "type": "function",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "findOne",
        "func": "msg.collection = \"categories\"\nmsg.query = {\n    // _id: objectid(msg.payload._id)\n}\nmsg.payload = {\n    $and: [\n        {_id: objectid(msg.payload._id)},\n        {deleted: false}\n    ]\n\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 360,
        "y": 160,
        "wires": [
            [
                "1a831082c4ec02e1"
            ]
        ]
    },
    {
        "id": "13bebcef94ddb1a1",
        "type": "function",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "delete",
        "func": "msg.collection = \"categories\"\nmsg.method = \"DELETE\"\n\nmsg.query = {\n    _id: objectid(msg.payload._id)\n}\nmsg.payload = {\n    $and: [\n        { _id: objectid(msg.payload._id) },\n        { deleted: false }\n    ]\n\n}\ndelete msg.payload._id\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 310,
        "y": 500,
        "wires": [
            [
                "e643d3173683741d",
                "3cef1644d4710622"
            ]
        ]
    },
    {
        "id": "1a831082c4ec02e1",
        "type": "link call",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 530,
        "y": 160,
        "wires": [
            [
                "e99cd1a49f29f041"
            ]
        ]
    },
    {
        "id": "d843e947608adfe2",
        "type": "function",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "dataMaping",
        "func": "msg.collection = \"categories\"\nmsg.payload =\n{\n    \"_id\": objectid(msg.fromApp._id),\n    \"deleted\": false,\n    \"name\": msg.payload.name,\n    \"description\": msg.payload.description,\n    \"slug\": msg.payload.slug,\n    \"createdAt\": new Date(new Date().toISOString()),\n    \"wooCommerceId\": msg.payload.id,\n};\nmsg.payload = msg.fromApp.parent?{\n    ...msg.payload,\n    \"parent\": +msg.fromApp.parent,\n    parent_id: objectid(msg.fromApp.parent)\n}: msg.payload\n//  parent_id: objectid(msg.fromApp.parent)\ndelete msg.payload.id\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 1010,
        "y": 60,
        "wires": [
            [
                "e2959056e055babf"
            ]
        ]
    },
    {
        "id": "4612cf60103ea4e9",
        "type": "function",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "wpError",
        "func": "msg.payload = {\n    success: false,\n    error: msg.payload\n}\nreturn msg;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1000,
        "y": 100,
        "wires": [
            [
                "21681a0e93af8404"
            ]
        ]
    },
    {
        "id": "21681a0e93af8404",
        "type": "http response",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1310,
        "y": 100,
        "wires": []
    },
    {
        "id": "f4a7ffaa1fe9daa3",
        "type": "http response",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1310,
        "y": 60,
        "wires": []
    },
    {
        "id": "8a5f8c42e08af4a4",
        "type": "function",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "dataMaping",
        "func": "msg.collection = \"categories\"\nmsg.query = {\n    _id: msg.fromApp._id\n}\nmsg.payload =\n{\n    \"name\": msg.fromApp.name,\n    \"description\": msg.fromApp.description,\n    \"slug\": msg.fromApp.slug,\n};\ndelete msg.fromApp._id\nmsg.payload = msg.fromApp.parent?{\n    $set: {\n        ...msg.fromApp,\n        \"parent\": +msg.fromApp.parent,\n    }\n}: {\n    $set: {\n        ...msg.fromApp,\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 1010,
        "y": 200,
        "wires": [
            [
                "1662e0c4bb1b6964"
            ]
        ]
    },
    {
        "id": "d64fca651f36b449",
        "type": "function",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "wpError",
        "func": "msg.payload = {\n    success: false,\n    error: msg.payload\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1000,
        "y": 240,
        "wires": [
            [
                "f7dfab3838b75b27"
            ]
        ]
    },
    {
        "id": "f7dfab3838b75b27",
        "type": "http response",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1330,
        "y": 240,
        "wires": []
    },
    {
        "id": "97eb537ba79e1caa",
        "type": "function",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "update",
        "func": "msg.query = {\n    _id: msg.category_info._id,\n    deleted: false,\n}\ndelete msg.payload._id;\nmsg.payload =\n{\n    $set: {\n        \"name\": msg.category_info.name + \"(DELETED_\" + Date.now() + \")\",\n        \"deleted\": true,\n        \"slug\": msg.category_info.slug + \"(DELETED_\" + Date.now() + \")\",\n    }\n\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 1350,
        "y": 480,
        "wires": [
            [
                "b8bbb554f7193525"
            ]
        ]
    },
    {
        "id": "a07ab63e69ae61d8",
        "type": "function",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "wpError",
        "func": "msg.payload = {\n    success: false,\n    error: msg.payload\n}\nreturn msg;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1360,
        "y": 520,
        "wires": [
            [
                "c56e73263d461df9"
            ]
        ]
    },
    {
        "id": "c56e73263d461df9",
        "type": "http response",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1670,
        "y": 520,
        "wires": []
    },
    {
        "id": "e643d3173683741d",
        "type": "link call",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 450,
        "y": 500,
        "wires": [
            [
                "604a654072259b5a",
                "3cef1644d4710622"
            ]
        ]
    },
    {
        "id": "604a654072259b5a",
        "type": "function",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "function 1",
        "func": "if (msg.payload.length > 0) {\n    msg.endpoint = `products/categories/${msg.payload[0].wooCommerceId}?force=true`\n    msg.category_info = msg.payload[0]\n    msg.payload ={}\n    return [msg, null]\n} else {\n    return [null, msg]\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 500,
        "wires": [
            [
                "db3d8a0225404425"
            ],
            [
                "084cef6caf0afe50"
            ]
        ]
    },
    {
        "id": "084cef6caf0afe50",
        "type": "function",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "404",
        "func": "msg.payload = {\n    success: false,\n    error: \"404 \" + msg.collection + \" does not exist\"\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 520,
        "wires": [
            [
                "426bd3e00d7ee8b1"
            ]
        ]
    },
    {
        "id": "426bd3e00d7ee8b1",
        "type": "http response",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 950,
        "y": 520,
        "wires": []
    },
    {
        "id": "5bf54fc5c3c30d7e",
        "type": "function",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "update",
        "func": "msg.collection = \"categories\"\nmsg.method = \"PUT\"\nmsg.endpoint = `products/categories/${msg.payload.wooCommerceId}`\nmsg.payload = {\n    ...msg.payload,\n    parent: + msg.payload.parent\n};\nmsg.fromApp = {\n    ...msg.payload,\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 220,
        "wires": [
            [
                "4441ee4978cd8588"
            ]
        ]
    },
    {
        "id": "3cef1644d4710622",
        "type": "debug",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "debug 8",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 600,
        "y": 420,
        "wires": []
    },
    {
        "id": "084e03545305bcab",
        "type": "subflow:9c49629805242044",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "",
        "x": 445,
        "y": 80,
        "wires": [
            [
                "dd2956d7767d94a7"
            ]
        ],
        "l": false
    },
    {
        "id": "dd2956d7767d94a7",
        "type": "subflow:95370d1e369768c7",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "",
        "x": 720,
        "y": 80,
        "wires": [
            [
                "d843e947608adfe2"
            ],
            [
                "4612cf60103ea4e9"
            ]
        ]
    },
    {
        "id": "15df488e0f2db9c1",
        "type": "debug",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "debug 12",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 380,
        "y": 340,
        "wires": []
    },
    {
        "id": "db3d8a0225404425",
        "type": "subflow:95370d1e369768c7",
        "z": "2d9205901ae51ca8",
        "g": "629d10c36b4dfe77",
        "name": "",
        "x": 890,
        "y": 480,
        "wires": [
            [
                "97eb537ba79e1caa"
            ],
            [
                "a07ab63e69ae61d8"
            ]
        ]
    },
    {
        "id": "19605553552a4898",
        "type": "http in",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "url": "/createSerie",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 90,
        "y": 80,
        "wires": [
            [
                "a8cdc751cc2a5317",
                "9f1d0855e5978176"
            ]
        ]
    },
    {
        "id": "eb27a3425fd15bbf",
        "type": "http response",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1350,
        "y": 40,
        "wires": []
    },
    {
        "id": "321e4ea9a92bcdd7",
        "type": "link call",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "links": [
            "1764f8568a80ddbd"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1150,
        "y": 40,
        "wires": [
            [
                "eb27a3425fd15bbf",
                "2931d098abd08a9a"
            ]
        ]
    },
    {
        "id": "a8cdc751cc2a5317",
        "type": "function",
        "z": "a1d95bc639a6eb03",
        "name": "create",
        "func": "msg.collection = \"series\"\nmsg.method = \"POST\"\nmsg.endpoint = \"products/categories\"\nmsg.fromApp = msg.payload;\nif(!msg.payload.parent_id){\n    return [null, msg]\n}\nmsg.payload = {\n    ...msg.payload,\n    parent: +msg.payload.parent,\n    deleted: false,\n    _id: objectid(),\n}\nmsg.fromApp = msg.payload \nreturn [msg, null];\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 270,
        "y": 80,
        "wires": [
            [
                "c2d21a8d7e77e4fa"
            ],
            [
                "452c5c1aff97b7e9"
            ]
        ]
    },
    {
        "id": "452c5c1aff97b7e9",
        "type": "function",
        "z": "a1d95bc639a6eb03",
        "name": "400",
        "func": "msg.payload = {\n    success: false,\n    error: \"400 body unvalid\"\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 100,
        "wires": [
            [
                "8b8a0c944c4cd353"
            ]
        ]
    },
    {
        "id": "8b8a0c944c4cd353",
        "type": "http response",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 610,
        "y": 100,
        "wires": []
    },
    {
        "id": "b63df845bf4329df",
        "type": "http in",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "url": "/updateSerie",
        "method": "put",
        "upload": false,
        "swaggerDoc": "",
        "x": 90,
        "y": 600,
        "wires": [
            [
                "903e4feb78f6db89",
                "4b786b3854f5f281"
            ]
        ]
    },
    {
        "id": "a437d77ae351d3cd",
        "type": "http in",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "url": "/deleteSerie",
        "method": "delete",
        "upload": false,
        "swaggerDoc": "",
        "x": 90,
        "y": 660,
        "wires": [
            [
                "33ba84105ac0e6e1"
            ]
        ]
    },
    {
        "id": "f3eb154509b6e834",
        "type": "http in",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "url": "/getSeries",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 80,
        "y": 820,
        "wires": [
            [
                "67a386a83d4863cb"
            ]
        ]
    },
    {
        "id": "bc99daf3f71579ea",
        "type": "http response",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 790,
        "y": 820,
        "wires": []
    },
    {
        "id": "0b8b1fa4c1b696c1",
        "type": "link call",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 530,
        "y": 820,
        "wires": [
            [
                "bc99daf3f71579ea"
            ]
        ]
    },
    {
        "id": "a0e0bfc93e0b9a60",
        "type": "http in",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "url": "/getSeria",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 70,
        "y": 880,
        "wires": [
            [
                "3c5e40d5e130b1d9"
            ]
        ]
    },
    {
        "id": "d2f6921aa1d9b575",
        "type": "http response",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 790,
        "y": 880,
        "wires": []
    },
    {
        "id": "3cac2555594b343b",
        "type": "link call",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 530,
        "y": 880,
        "wires": [
            [
                "d2f6921aa1d9b575"
            ]
        ]
    },
    {
        "id": "431af794c0d77b0e",
        "type": "function",
        "z": "a1d95bc639a6eb03",
        "name": "update",
        "func": "msg.collection = \"series\";\nmsg.method = \"PUT\"\nmsg.endpoint = `products/categories/${msg.fromApp.wooCommerceId}`\nmsg.payload = {\n    ...msg.fromApp,\n    parent: + msg.parent\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 600,
        "wires": [
            [
                "a13da8fe0206b512",
                "a5c109f90972c594"
            ]
        ]
    },
    {
        "id": "33ba84105ac0e6e1",
        "type": "function",
        "z": "a1d95bc639a6eb03",
        "name": "delete",
        "func": "msg.collection = \"series\"\nmsg.method = \"DELETE\"\nmsg.query = {\n    _id: objectid(msg.payload._id)\n}\nmsg.payload = {\n    $and: [\n        { _id: objectid(msg.payload._id)},\n        { deleted: false }\n    ]\n\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 310,
        "y": 660,
        "wires": [
            [
                "d73193d095887ffb"
            ]
        ]
    },
    {
        "id": "67a386a83d4863cb",
        "type": "function",
        "z": "a1d95bc639a6eb03",
        "name": "find",
        "func": "msg.collection = \"series\"\nif (msg.payload.q) {\n    msg.payload = {\n        $and: [\n            {\n                $or: [\n                    { \"name\": { $regex: msg.payload.q, $options: \"i\" } },\n                    { \"description\": { $regex: msg.payload.q, $options: \"i\" } }\n                ]\n            },\n            { ...msg.payload, deleted: false }\n        ]\n    };\n} else {\n    msg.payload = { ...msg.payload, deleted: false   }\n}\ndelete msg.payload.q\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 820,
        "wires": [
            [
                "0b8b1fa4c1b696c1"
            ]
        ]
    },
    {
        "id": "3c5e40d5e130b1d9",
        "type": "function",
        "z": "a1d95bc639a6eb03",
        "name": "findOne",
        "func": "msg.collection = \"series\"\nmsg.query = {\n    // _id: objectid(msg.payload._id)\n}\nmsg.payload = {\n    $and: [\n        { _id: objectid(msg.payload._id) },\n        { deleted: false }\n    ]\n\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 300,
        "y": 880,
        "wires": [
            [
                "3cac2555594b343b"
            ]
        ]
    },
    {
        "id": "5db0e731cfcec915",
        "type": "function",
        "z": "a1d95bc639a6eb03",
        "name": "replaceByWooCommerce",
        "func": "msg.payload =\n{\n    ...msg.payload,\n    id: Math.round(Math.random() * 10000),\n    name: msg.payload.name,\n    slug: msg.payload.slug,\n    description: msg.payload.description\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 240,
        "wires": [
            [
                "d825487211bc778f"
            ]
        ]
    },
    {
        "id": "d825487211bc778f",
        "type": "function",
        "z": "a1d95bc639a6eb03",
        "name": "checkStatus",
        "func": "if (msg.statusCode == 201 || true) {\n    return [msg, null]\n} else {\n    return [null, msg]\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 240,
        "wires": [
            [
                "a620b82cae52c2aa"
            ],
            [
                "fe7591d4c9973d20"
            ]
        ]
    },
    {
        "id": "fe7591d4c9973d20",
        "type": "function",
        "z": "a1d95bc639a6eb03",
        "name": "wpError",
        "func": "msg.payload = {\n    success: false,\n    error: msg.payload\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 880,
        "y": 260,
        "wires": [
            [
                "a9a6f78a7e972d7f"
            ]
        ]
    },
    {
        "id": "a9a6f78a7e972d7f",
        "type": "http response",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1030,
        "y": 260,
        "wires": []
    },
    {
        "id": "a620b82cae52c2aa",
        "type": "function",
        "z": "a1d95bc639a6eb03",
        "name": "function",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 880,
        "y": 220,
        "wires": [
            [
                "2c8aaca4937aa1af"
            ]
        ]
    },
    {
        "id": "2c8aaca4937aa1af",
        "type": "link call",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "links": [],
        "linkType": "static",
        "timeout": "30",
        "x": 1030,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "7ff495a5fc81eb03",
        "type": "function",
        "z": "a1d95bc639a6eb03",
        "name": "wpError",
        "func": "msg.payload = {\n    success: false,\n    error: msg.payload\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 80,
        "wires": [
            [
                "05d0bcb65f35de1b"
            ]
        ]
    },
    {
        "id": "05d0bcb65f35de1b",
        "type": "http response",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1070,
        "y": 80,
        "wires": []
    },
    {
        "id": "1e68ad842fa65eb0",
        "type": "function",
        "z": "a1d95bc639a6eb03",
        "name": "function",
        "func": "msg.collection = \"series\"\nmsg.payload =\n{\n    \"_id\": objectid(msg.fromApp._id),\n    \"deleted\": false,\n    \"name\": msg.payload.name,\n    \"description\": msg.payload.description,\n    \"slug\": msg.payload.slug,\n    \"createdAt\": new Date(new Date().toISOString()),\n    \"wooCommerceId\": msg.payload.id,\n    \"parent\": +msg.payload.parent,\n    \"parent_id\": objectid(msg.fromApp.parent_id)\n};\ndelete msg.payload.id\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 920,
        "y": 40,
        "wires": [
            [
                "321e4ea9a92bcdd7",
                "d1ce3738df14034e"
            ]
        ]
    },
    {
        "id": "569c677c8287af36",
        "type": "function",
        "z": "a1d95bc639a6eb03",
        "name": "wpError",
        "func": "msg.payload = {\n    success: false,\n    error: msg.payload\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 620,
        "wires": [
            [
                "f79d2648564c1294"
            ]
        ]
    },
    {
        "id": "f79d2648564c1294",
        "type": "http response",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1070,
        "y": 620,
        "wires": []
    },
    {
        "id": "990fcf3fab5abbdb",
        "type": "function",
        "z": "a1d95bc639a6eb03",
        "name": "function",
        "func": "msg.collection = \"series\"\nmsg.query = {\n    _id: msg.fromApp._id\n}\nmsg.payload =\n{\n    \"name\": msg.fromApp.name,\n    \"description\": msg.fromApp.description,\n    \"slug\": msg.fromApp.slug,\n};\ndelete msg.fromApp._id\nmsg.payload = msg.fromApp.parent ? {\n    $set: {\n        ...msg.fromApp,\n        \"parent\": +msg.fromApp.parent,\n        \"parent_id\": objectid(msg.fromApp.parent_id)\n    }\n} : {\n    $set: {\n        ...msg.fromApp,\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 920,
        "y": 580,
        "wires": [
            [
                "963eb37567ccde1f",
                "50245206e42c81bd"
            ]
        ]
    },
    {
        "id": "8552cf755d0950ef",
        "type": "http response",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1350,
        "y": 580,
        "wires": []
    },
    {
        "id": "963eb37567ccde1f",
        "type": "link call",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "links": [
            "286431cd31c9fc7a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1100,
        "y": 580,
        "wires": [
            [
                "8552cf755d0950ef"
            ]
        ]
    },
    {
        "id": "9db42437e961586e",
        "type": "function",
        "z": "a1d95bc639a6eb03",
        "name": "wpError",
        "func": "msg.payload = {\n    success: false,\n    error: msg.payload\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1380,
        "y": 680,
        "wires": [
            [
                "b5acb1559f653d42"
            ]
        ]
    },
    {
        "id": "b5acb1559f653d42",
        "type": "http response",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1530,
        "y": 680,
        "wires": []
    },
    {
        "id": "d676260b6de077a2",
        "type": "function",
        "z": "a1d95bc639a6eb03",
        "name": "function",
        "func": "msg.query = {\n    _id: msg.category_info._id,\n}\ndelete msg.payload._id;\nmsg.payload =\n{\n    $set: {\n        \"name\": msg.category_info.name + \"(DELETED_\" + Date.now() + \")\",\n        \"deleted\": true,\n        \"slug\": msg.category_info.slug + \"(DELETED_\" + Date.now() + \")\",\n    }\n\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1380,
        "y": 640,
        "wires": [
            [
                "0a0f15ea980dfb47"
            ]
        ]
    },
    {
        "id": "bf54447682a91e58",
        "type": "http response",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1930,
        "y": 640,
        "wires": []
    },
    {
        "id": "0a0f15ea980dfb47",
        "type": "link call",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "links": [
            "286431cd31c9fc7a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1680,
        "y": 640,
        "wires": [
            [
                "bf54447682a91e58"
            ]
        ]
    },
    {
        "id": "d73193d095887ffb",
        "type": "link call",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 470,
        "y": 660,
        "wires": [
            [
                "d95cfdb697d7b3e9"
            ]
        ]
    },
    {
        "id": "d95cfdb697d7b3e9",
        "type": "function",
        "z": "a1d95bc639a6eb03",
        "name": "function",
        "func": "if (msg.payload.length > 0) {\n    msg.endpoint = `products/categories/${msg.payload[0].wooCommerceId}?force=true`\n    msg.category_info = msg.payload[0]\n    msg.payload = {}\n    return [msg, null]\n} else {\n    return [null, msg]\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 640,
        "y": 660,
        "wires": [
            [
                "640df79855e96c4c"
            ],
            [
                "af21f883eb5b562c"
            ]
        ]
    },
    {
        "id": "af21f883eb5b562c",
        "type": "function",
        "z": "a1d95bc639a6eb03",
        "name": "404",
        "func": "msg.payload = {\n    success: false,\n    error: \"404 \" + msg.collection + \" does not exist\"\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 700,
        "wires": [
            [
                "1e8820c7d7835aec"
            ]
        ]
    },
    {
        "id": "1e8820c7d7835aec",
        "type": "http response",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 970,
        "y": 700,
        "wires": []
    },
    {
        "id": "9f1d0855e5978176",
        "type": "debug",
        "z": "a1d95bc639a6eb03",
        "name": "debug 2",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 300,
        "y": 140,
        "wires": []
    },
    {
        "id": "3b7b785bc8e843f3",
        "type": "debug",
        "z": "a1d95bc639a6eb03",
        "name": "debug 3",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 740,
        "y": 100,
        "wires": []
    },
    {
        "id": "d1ce3738df14034e",
        "type": "debug",
        "z": "a1d95bc639a6eb03",
        "name": "debug 4",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1120,
        "y": 120,
        "wires": []
    },
    {
        "id": "2931d098abd08a9a",
        "type": "debug",
        "z": "a1d95bc639a6eb03",
        "name": "debug 5",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1360,
        "y": 80,
        "wires": []
    },
    {
        "id": "c2d21a8d7e77e4fa",
        "type": "subflow:9c49629805242044",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "x": 375,
        "y": 60,
        "wires": [
            [
                "a4d9dcd497977bdf"
            ]
        ],
        "l": false
    },
    {
        "id": "a13da8fe0206b512",
        "type": "subflow:95370d1e369768c7",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "x": 610,
        "y": 600,
        "wires": [
            [
                "990fcf3fab5abbdb",
                "50245206e42c81bd"
            ],
            [
                "569c677c8287af36"
            ]
        ]
    },
    {
        "id": "4d2618e848f7d0ec",
        "type": "subflow:95370d1e369768c7",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "x": 630,
        "y": 60,
        "wires": [
            [
                "1e68ad842fa65eb0"
            ],
            [
                "7ff495a5fc81eb03"
            ]
        ]
    },
    {
        "id": "640df79855e96c4c",
        "type": "subflow:95370d1e369768c7",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "x": 990,
        "y": 660,
        "wires": [
            [
                "d676260b6de077a2"
            ],
            [
                "9db42437e961586e"
            ]
        ]
    },
    {
        "id": "0724b9104a6ee3d6",
        "type": "function",
        "z": "a1d95bc639a6eb03",
        "name": "function 7",
        "func": "msg.collection = \"series\"\nmsg.method = \"POST\"\nmsg.endpoint = \"products/categories\"\nmsg.fromApp = msg.payload;\nif (!msg.payload.parent && !msg.payload.parent_id) {\n    return [null, msg]\n}\nmsg.payload = {\n    ...msg.payload,\n    parent: +msg.parent,\n    deleted: false,\n    _id: objectid(),\n}\nmsg.fromApp = msg.payload\nreturn [msg, null];\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 920,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "7c28c9a8e684dc32",
        "type": "link in",
        "z": "a1d95bc639a6eb03",
        "name": "Find Parent",
        "links": [],
        "x": 135,
        "y": 1040,
        "wires": [
            [
                "97da66984c23a27c"
            ]
        ]
    },
    {
        "id": "601e89bced9b89c9",
        "type": "link out",
        "z": "a1d95bc639a6eb03",
        "name": "link out 6",
        "mode": "return",
        "links": [],
        "x": 565,
        "y": 1040,
        "wires": []
    },
    {
        "id": "35051317718fe046",
        "type": "link call",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 470,
        "y": 1160,
        "wires": [
            [
                "206b8de572239fb9",
                "df18402f6ec0f417"
            ]
        ]
    },
    {
        "id": "97da66984c23a27c",
        "type": "function",
        "z": "a1d95bc639a6eb03",
        "name": "findParent",
        "func": "msg.collection = \"categories\"\nmsg.fromApp = msg.payload;\nmsg.payload = {\n    _id: objectid(msg.payload.parent_id)\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 270,
        "y": 1200,
        "wires": [
            [
                "35051317718fe046"
            ]
        ]
    },
    {
        "id": "206b8de572239fb9",
        "type": "function",
        "z": "a1d95bc639a6eb03",
        "name": "checkParent",
        "func": "if (msg.payload.length > 0) {\n    msg.parent = msg.payload[0].wooCommerceId;\n    msg.payload = {}\n\n    return [msg, null]\n} else {\n    return [null, msg]\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 1160,
        "wires": [
            [
                "601e89bced9b89c9"
            ],
            [
                "864794b2e9db8238"
            ]
        ]
    },
    {
        "id": "864794b2e9db8238",
        "type": "function",
        "z": "a1d95bc639a6eb03",
        "name": "404",
        "func": "msg.payload = {\n    success: false,\n    error: \"404 \" + msg.collection + \" does not exist\"\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 1180,
        "wires": [
            [
                "5bcd049c07b720e2"
            ]
        ]
    },
    {
        "id": "5bcd049c07b720e2",
        "type": "http response",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 970,
        "y": 1180,
        "wires": []
    },
    {
        "id": "903e4feb78f6db89",
        "type": "link call",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "links": [
            "7c28c9a8e684dc32"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 270,
        "y": 600,
        "wires": [
            [
                "431af794c0d77b0e",
                "a5c109f90972c594"
            ]
        ]
    },
    {
        "id": "a4d9dcd497977bdf",
        "type": "link call",
        "z": "a1d95bc639a6eb03",
        "name": "",
        "links": [
            "7c28c9a8e684dc32"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 450,
        "y": 300,
        "wires": [
            [
                "ce8660e90297cbbf"
            ]
        ]
    },
    {
        "id": "ce8660e90297cbbf",
        "type": "function",
        "z": "a1d95bc639a6eb03",
        "name": "function 8",
        "func": "msg.collection = \"series\"\nmsg.method = \"POST\"\nmsg.endpoint = \"products/categories\"\nmsg.payload = {\n    ...msg.fromApp,\n    parent: +msg.parent,\n}\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 300,
        "wires": [
            [
                "4d2618e848f7d0ec",
                "81c2af01dbb9548d"
            ]
        ]
    },
    {
        "id": "df18402f6ec0f417",
        "type": "debug",
        "z": "a1d95bc639a6eb03",
        "name": "debug 13",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 700,
        "y": 1240,
        "wires": []
    },
    {
        "id": "81c2af01dbb9548d",
        "type": "debug",
        "z": "a1d95bc639a6eb03",
        "name": "debug 14",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 840,
        "y": 360,
        "wires": []
    },
    {
        "id": "4b786b3854f5f281",
        "type": "debug",
        "z": "a1d95bc639a6eb03",
        "name": "debug 21",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 460,
        "y": 480,
        "wires": []
    },
    {
        "id": "a5c109f90972c594",
        "type": "debug",
        "z": "a1d95bc639a6eb03",
        "name": "debug 22",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 620,
        "y": 520,
        "wires": []
    },
    {
        "id": "50245206e42c81bd",
        "type": "debug",
        "z": "a1d95bc639a6eb03",
        "name": "debug 23",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1320,
        "y": 500,
        "wires": []
    },
    {
        "id": "4ad0245be2fd68a3",
        "type": "http in",
        "z": "aa0dea3e1560be14",
        "name": "",
        "url": "/css",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 120,
        "y": 60,
        "wires": [
            [
                "74b83fe8cd5d46e9"
            ]
        ]
    },
    {
        "id": "1f200587808cf15e",
        "type": "http response",
        "z": "aa0dea3e1560be14",
        "name": "",
        "statusCode": "",
        "headers": {
            "content-type": "text/css"
        },
        "x": 450,
        "y": 60,
        "wires": []
    },
    {
        "id": "74b83fe8cd5d46e9",
        "type": "template",
        "z": "aa0dea3e1560be14",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "css",
        "syntax": "mustache",
        "template": "body section{\n     background-color: #E6E6FA!important;\n}\n.list-item{\n     padding: 4px!important;\n}\n.list-item>div>div>div>div{\n     box-shadow: 0 0 4px rgba(0, 0, 0, 0.4)!important;\n}\n.list-item>div>div>div>div:hover {\n    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5)!important; /*     */\n}\n.category-list>div>div>div>div{\n     border-radius: 10px!important;\n}\n\n.nav-link:hover span{\n     cursor: pointer!important;\n     color: #E6E6FA!important;\n}\n",
        "output": "str",
        "x": 280,
        "y": 60,
        "wires": [
            [
                "1f200587808cf15e"
            ]
        ]
    },
    {
        "id": "f84a5c82181406ed",
        "type": "http in",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "url": "/createAttribute",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 180,
        "wires": [
            [
                "1b9a40e54db6dee0"
            ]
        ]
    },
    {
        "id": "3cc298dc4a42a016",
        "type": "link call",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "links": [
            "1764f8568a80ddbd"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1210,
        "y": 160,
        "wires": [
            [
                "11f2912b8e4258a7"
            ]
        ]
    },
    {
        "id": "11f2912b8e4258a7",
        "type": "http response",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1390,
        "y": 160,
        "wires": []
    },
    {
        "id": "1b9a40e54db6dee0",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "function",
        "func": "msg.collection = \"attributes\";\nmsg.endpoint = \"products/attributes\";\nmsg.method = \"POST\";\nmsg.fromApp = {\n    _id: objectid(),\n    \"name\": msg.payload.name.toLowerCase(),\n    \"slug\": msg.payload.slug,\n    \"image\": msg.payload.image,\n    \"description\": msg.payload.description,\n    \"deleted\": false,\n    \"createdAt\": new Date(),\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 400,
        "y": 180,
        "wires": [
            [
                "70614985f556af14"
            ]
        ]
    },
    {
        "id": "ca419928cba01638",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "create",
        "func": "msg.collection = \"attributes\";\nmsg.wooCommerceId = msg.payload.id\n\n\nmsg.payload = {\n    ...msg.fromApp,\n    \"wooCommerceId\": msg.wooCommerceId\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 1030,
        "y": 160,
        "wires": [
            [
                "3cc298dc4a42a016"
            ]
        ]
    },
    {
        "id": "be090bf6086c2e5b",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "wpError",
        "func": "msg.payload = {\n    success: false,\n    error: msg.payload\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1040,
        "y": 200,
        "wires": [
            [
                "09867e0ecc5befe3"
            ]
        ]
    },
    {
        "id": "09867e0ecc5befe3",
        "type": "http response",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1390,
        "y": 200,
        "wires": []
    },
    {
        "id": "dd40027ce76edec7",
        "type": "http in",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "url": "/updateAttribute",
        "method": "put",
        "upload": false,
        "swaggerDoc": "",
        "x": 150,
        "y": 280,
        "wires": [
            [
                "9d922ae1a813ed34"
            ]
        ]
    },
    {
        "id": "9d922ae1a813ed34",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "save request payload",
        "func": "msg.fromApp = msg.payload;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 360,
        "y": 280,
        "wires": [
            [
                "b85a5984830c4ca4"
            ]
        ]
    },
    {
        "id": "e788be40b0c64c95",
        "type": "link call",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "links": [
            "286431cd31c9fc7a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1220,
        "y": 260,
        "wires": [
            [
                "90d806b7fe2ea5dc"
            ]
        ]
    },
    {
        "id": "90d806b7fe2ea5dc",
        "type": "http response",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1390,
        "y": 260,
        "wires": []
    },
    {
        "id": "1031137b79619212",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "update",
        "func": "msg.query = {\n    _id: objectid(msg.fromApp._id)\n}\nmsg.payload =\n{\n    \"name\": msg.fromApp.name,\n    \"description\": msg.fromApp.description,\n    \"slug\": msg.fromApp.slug,\n    deleted: false\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 1070,
        "y": 260,
        "wires": [
            [
                "e788be40b0c64c95"
            ]
        ]
    },
    {
        "id": "bc36c7c20a9cfd11",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "wpError",
        "func": "msg.payload = {\n    success: false,\n    error: msg.payload\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 300,
        "wires": [
            [
                "abe7a7b72a0d7e99"
            ]
        ]
    },
    {
        "id": "abe7a7b72a0d7e99",
        "type": "http response",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1390,
        "y": 300,
        "wires": []
    },
    {
        "id": "8556bc7025b148e6",
        "type": "http in",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "url": "/deleteAttribute",
        "method": "delete",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 380,
        "wires": [
            [
                "78cd7fdb3b898de8"
            ]
        ]
    },
    {
        "id": "858de738a2ca1017",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "function",
        "func": "msg.collection = \"attributes\";\nmsg.endpoint = `products/attributes/${msg.payload.wooCommerceId}`;\nmsg.method = \"DELETE\";\nmsg.query = {\n    _id: objectid(msg.fromApp._id)\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 860,
        "y": 360,
        "wires": [
            [
                "df0ad2128bad917a"
            ]
        ]
    },
    {
        "id": "0a59694c327c8197",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "delete",
        "func": "msg.query = {\n    _id: msg.fromApp._id,\n    deleted: false,\n}\ndelete msg.payload._id;\nmsg.payload =\n{\n    $set: {\n        \"name\": msg.payload.name + \"(DELETED_\" + Date.now() + \")\",\n        \"deleted\": true,\n        \"slug\": msg.payload.slug + \"(DELETED_\" + Date.now() + \")\",\n    }\n\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 1390,
        "y": 340,
        "wires": [
            [
                "63a4fb2d20eac184"
            ]
        ]
    },
    {
        "id": "eabc941571390beb",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "wpError",
        "func": "msg.payload = {\n    success: false,\n    error: msg.payload\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1400,
        "y": 380,
        "wires": [
            [
                "d4b0ab4f130c560b"
            ]
        ]
    },
    {
        "id": "78cd7fdb3b898de8",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "function",
        "func": "msg.collection = \"attributes\"\nmsg.fromApp = msg.payload\nmsg.payload = {\n    $and: [\n        { _id:objectid(msg.payload._id)},\n        { deleted: false }\n    ]\n\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 340,
        "y": 380,
        "wires": [
            [
                "56399f41ccfab03c"
            ]
        ]
    },
    {
        "id": "56399f41ccfab03c",
        "type": "link call",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 530,
        "y": 380,
        "wires": [
            [
                "3035a74702b8aa01"
            ]
        ]
    },
    {
        "id": "3035a74702b8aa01",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "function",
        "func": "if (msg.payload.length > 0) {\n    msg.payload= msg.payload[0]\n    return [msg, null]\n} else {\n    return [null, msg]\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 380,
        "wires": [
            [
                "858de738a2ca1017"
            ],
            [
                "ba479d9b3ed467b8"
            ]
        ]
    },
    {
        "id": "ba479d9b3ed467b8",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "404",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 850,
        "y": 400,
        "wires": [
            [
                "070b2a23f3f3170e"
            ]
        ]
    },
    {
        "id": "070b2a23f3f3170e",
        "type": "http response",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1050,
        "y": 400,
        "wires": []
    },
    {
        "id": "ac87e071fad4a0c3",
        "type": "http in",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "url": "/getAttribute",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 580,
        "wires": [
            [
                "bff5ea34eba1ccd9"
            ]
        ]
    },
    {
        "id": "bff5ea34eba1ccd9",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "function",
        "func": "msg.collection = \"attributes\"\nmsg.payload = {\n    _id: objectid(msg.payload._id)\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 340,
        "y": 580,
        "wires": [
            [
                "6ad4537780e2d6a6"
            ]
        ]
    },
    {
        "id": "6ad4537780e2d6a6",
        "type": "link call",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 510,
        "y": 580,
        "wires": [
            [
                "9dcc0fa6f819953c"
            ]
        ]
    },
    {
        "id": "9dcc0fa6f819953c",
        "type": "http response",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 710,
        "y": 580,
        "wires": []
    },
    {
        "id": "3909532d88dd6fb3",
        "type": "http in",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "url": "/getAttributes",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 150,
        "y": 640,
        "wires": [
            [
                "5c89480f979acc5a"
            ]
        ]
    },
    {
        "id": "5c89480f979acc5a",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "function",
        "func": "msg.collection = \"attributes\";\nconst pipeline = []\nmsg.payload && pipeline.push({\n    $lookup: {\n        from: \"terms\",\n        localField: \"_id\",\n        foreignField: \"parent_id\",\n        as: \"terms\"\n    }\n})\nmsg.payload.q && pipeline.push({\n    $match: {\n        $and: [\n            {\n                $or: [\n                    { \"name\": { $regex: msg.payload.q, $options: \"i\" } },\n                    { \"description\": { $regex: msg.payload.q, $options: \"i\" } }\n                ]\n            },\n            { deleted: false }\n        ]\n    },\n})\n// if (msg.payload.q) {\n    // msg.payload ={\n    //         $match: {\n    //             $and: [\n    //                 {\n    //                     $or: [\n    //                         { \"name\": { $regex: msg.payload.q, $options: \"i\" } },\n    //                         { \"description\": { $regex: msg.payload.q, $options: \"i\" } }\n    //                     ]\n    //                 },\n    //                 { deleted: false }\n    //             ]\n    //         },\n    //     };\n// } else {\n//     msg.payload = \n//         {\n//         deleted: false\n//         };\n// }\n\nmsg.payload = [ ...pipeline\n,{\n        $match: {\n            deleted: false\n        }\n    }\n]\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 640,
        "wires": [
            [
                "83afa7c55ce2fe5a"
            ]
        ]
    },
    {
        "id": "83afa7c55ce2fe5a",
        "type": "link call",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "links": [
            "b7c366424b9b7e6e"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 530,
        "y": 640,
        "wires": [
            [
                "caad24d87e2f6648"
            ]
        ]
    },
    {
        "id": "caad24d87e2f6648",
        "type": "http response",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 710,
        "y": 640,
        "wires": []
    },
    {
        "id": "a80d9f6dd78513bc",
        "type": "http in",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "url": "/createTerm",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 150,
        "y": 900,
        "wires": [
            [
                "b92eb0c101f74434"
            ]
        ]
    },
    {
        "id": "b92eb0c101f74434",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "function",
        "func": "msg.collection = \"terms\"\nif (!msg.payload.parent_id) {\n    return [null, msg]\n}\nmsg.payload = {\n    ...msg.payload,\n    deleted: false,\n    _id: objectid(),\n    parent_id: objectid(msg.payload.parent_id)\n}\nmsg.fromApp = {...msg.payload};\nmsg.payload = {_id: msg.payload.parent_id}\nreturn [msg, null];\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 360,
        "y": 900,
        "wires": [
            [
                "4b3bc8787ec35c6b"
            ],
            [
                "50f2cf1ba89b7a1f"
            ]
        ]
    },
    {
        "id": "e52aa67d23edf43f",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "create",
        "func": "msg.wooCommerceId = msg.payload.id\nmsg.collection = \"terms\"\n\nmsg.payload = {\n    ...msg.fromApp,\n    \"wooCommerceId\": msg.wooCommerceId,\n    deleted: false\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 1090,
        "y": 880,
        "wires": [
            [
                "d7119e20a53394f3"
            ]
        ]
    },
    {
        "id": "5b2e0bea5805449c",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "wpError",
        "func": "msg.payload = {\n    success: false,\n    error: msg.payload\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1100,
        "y": 920,
        "wires": [
            [
                "62b4c521fd9575af"
            ]
        ]
    },
    {
        "id": "50f2cf1ba89b7a1f",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "400",
        "func": "msg.payload = {\n    success: false,\n    error: \"400 body unvalid\"\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 920,
        "wires": [
            [
                "c43fe077b308ff4a"
            ]
        ]
    },
    {
        "id": "c43fe077b308ff4a",
        "type": "http response",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 710,
        "y": 920,
        "wires": []
    },
    {
        "id": "d7119e20a53394f3",
        "type": "link call",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "links": [
            "1764f8568a80ddbd"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1290,
        "y": 880,
        "wires": [
            [
                "3089fba5b155dc71"
            ]
        ]
    },
    {
        "id": "62b4c521fd9575af",
        "type": "http response",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1270,
        "y": 920,
        "wires": []
    },
    {
        "id": "3089fba5b155dc71",
        "type": "http response",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1470,
        "y": 880,
        "wires": []
    },
    {
        "id": "63a4fb2d20eac184",
        "type": "link call",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "links": [
            "286431cd31c9fc7a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1620,
        "y": 340,
        "wires": [
            [
                "5cc0cdcaed3fa746"
            ]
        ]
    },
    {
        "id": "5cc0cdcaed3fa746",
        "type": "http response",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1870,
        "y": 340,
        "wires": []
    },
    {
        "id": "d4b0ab4f130c560b",
        "type": "http response",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1590,
        "y": 380,
        "wires": []
    },
    {
        "id": "c50aaaa64917103d",
        "type": "http in",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "url": "/deleteTerm",
        "method": "delete",
        "upload": false,
        "swaggerDoc": "",
        "x": 150,
        "y": 1000,
        "wires": [
            [
                "9f3206505ff93c78"
            ]
        ]
    },
    {
        "id": "7470e77c65843ad1",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "function",
        "func": "msg.endpoint = `products/attributes/${msg.payload.wooCommerceId}/terms/${msg.fromApp.wooCommerceId}?force=true`\nmsg.method = \"Delete\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 980,
        "y": 1000,
        "wires": [
            [
                "206f67c13f7eb026"
            ]
        ]
    },
    {
        "id": "821dd74d89377212",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "delete",
        "func": "msg.collection = \"terms\"\nmsg.query = {\n    _id: objectid(msg.fromApp._id),\n}\ndelete msg.payload._id;\nmsg.payload =\n{\n    $set: {\n        \"name\": msg.fromApp.name + \"(DELETED_\" + Date.now() + \")\",\n        \"deleted\": true,\n        \"slug\": msg.fromApp.slug + \"(DELETED_\" + Date.now() + \")\",\n    }\n\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 1490,
        "y": 980,
        "wires": [
            [
                "6abd76fe7e4f092b"
            ]
        ]
    },
    {
        "id": "7d66d6cc2024f2d9",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "wpError",
        "func": "msg.payload = {\n    success: false,\n    error: msg.payload\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 1020,
        "wires": [
            [
                "a042e3b3132297e1"
            ]
        ]
    },
    {
        "id": "9f3206505ff93c78",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "function",
        "func": "msg.collection = \"terms\"\n// msg.query = {\n//     _id: objectid(msg.payload._id)\n// }\nmsg.payload = {\n    $and: [\n        { _id: objectid(msg.payload._id) },\n        { deleted: false }\n    ]\n\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 340,
        "y": 1000,
        "wires": [
            [
                "b813ca455fc27e8d"
            ]
        ]
    },
    {
        "id": "b813ca455fc27e8d",
        "type": "link call",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 530,
        "y": 1000,
        "wires": [
            [
                "7a857835fbd00554"
            ]
        ]
    },
    {
        "id": "7a857835fbd00554",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "function",
        "func": "if (msg.payload.length > 0) {\n    msg.payload = msg.payload[0]\n    msg.fromApp = msg.payload\n    msg.payload = {\n        _id: msg.payload.parent_id\n    }\n    return [msg, null]\n} else {\n    return [null, msg]\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 1020,
        "wires": [
            [
                "c12da43f252d97f3"
            ],
            [
                "911c38ea2da46243"
            ]
        ]
    },
    {
        "id": "911c38ea2da46243",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "404",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 850,
        "y": 1040,
        "wires": [
            [
                "c47fa653b195eae1"
            ]
        ]
    },
    {
        "id": "c47fa653b195eae1",
        "type": "http response",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1030,
        "y": 1040,
        "wires": []
    },
    {
        "id": "6abd76fe7e4f092b",
        "type": "link call",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "links": [
            "286431cd31c9fc7a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1680,
        "y": 980,
        "wires": [
            [
                "e90a91c848072fd1"
            ]
        ]
    },
    {
        "id": "e90a91c848072fd1",
        "type": "http response",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1890,
        "y": 980,
        "wires": []
    },
    {
        "id": "a042e3b3132297e1",
        "type": "http response",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1650,
        "y": 1020,
        "wires": []
    },
    {
        "id": "ded3116b88996d67",
        "type": "http in",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "url": "/updateTerm",
        "method": "put",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 1120,
        "wires": [
            [
                "60ad6f994738f4c9"
            ]
        ]
    },
    {
        "id": "60ad6f994738f4c9",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "function",
        "func": "msg.collection = \"terms\";\nmsg.fromApp = msg.payload;\nmsg.payload = {\n    _id: msg.payload.parent_id\n}\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 340,
        "y": 1120,
        "wires": [
            [
                "d990aa27f52bf6f6"
            ]
        ]
    },
    {
        "id": "95e7387c5c901e98",
        "type": "link call",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "links": [
            "1764f8568a80ddbd"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1210,
        "y": 1100,
        "wires": [
            [
                "8ae4119bae5e0360"
            ]
        ]
    },
    {
        "id": "8ae4119bae5e0360",
        "type": "http response",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1390,
        "y": 1100,
        "wires": []
    },
    {
        "id": "bce2955d960805de",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "update",
        "func": "msg.collection = \"terms\"\nmsg.query = {\n    _id: msg.fromApp._id\n}\nmsg.payload =\n{\n    \"name\": msg.fromApp.name,\n    \"description\": msg.fromApp.description,\n    \"slug\": msg.fromApp.slug,\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 1030,
        "y": 1100,
        "wires": [
            [
                "95e7387c5c901e98"
            ]
        ]
    },
    {
        "id": "aeb166cf849c736e",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "wpError",
        "func": "msg.payload = {\n    success: false,\n    error: msg.payload\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1040,
        "y": 1140,
        "wires": [
            [
                "e8cdb5fa19ab4e40"
            ]
        ]
    },
    {
        "id": "e8cdb5fa19ab4e40",
        "type": "http response",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1390,
        "y": 1140,
        "wires": []
    },
    {
        "id": "057b375802e8b01d",
        "type": "http in",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "url": "/getTerm",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 130,
        "y": 1200,
        "wires": [
            [
                "8fe978724c9e3be4"
            ]
        ]
    },
    {
        "id": "8fe978724c9e3be4",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "function",
        "func": "msg.collection = \"terms\"\nmsg.query = {\n    _id: msg.payload._id\n}\ndelete msg.payload._id\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 1200,
        "wires": [
            [
                "2300b6ee45522648"
            ]
        ]
    },
    {
        "id": "2300b6ee45522648",
        "type": "link call",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 510,
        "y": 1200,
        "wires": [
            [
                "d2b342075085d5cf"
            ]
        ]
    },
    {
        "id": "d2b342075085d5cf",
        "type": "http response",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 710,
        "y": 1200,
        "wires": []
    },
    {
        "id": "02132b0b76763e31",
        "type": "http in",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "url": "/getTerms",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 1260,
        "wires": [
            [
                "316536c8880bb038"
            ]
        ]
    },
    {
        "id": "316536c8880bb038",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "function",
        "func": "msg.collection = \"terms\"\nif (msg.payload.q) {\n    msg.payload = {\n        $and: [\n            {\n                $or: [\n                    { \"name\": { $regex: msg.payload.q, $options: \"i\" } },\n                    { \"description\": { $regex: msg.payload.q, $options: \"i\" } }\n                ]\n            },\n            {parent_id: msg.payload.parent_id},\n            { deleted: false }\n        ]\n    };\n} else {\n    msg.payload = {\n        ...msg.payload,\n        deleted: false\n    }\n}\nif (msg.payload.parent_id){\n    msg.payload = {\n        ...msg.payload,\n        parent_id: objectid(msg.payload.parent_id),\n\n    }\n}\ndelete msg.payload.q\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 340,
        "y": 1260,
        "wires": [
            [
                "c47dba7cc2c0c6e3"
            ]
        ]
    },
    {
        "id": "c47dba7cc2c0c6e3",
        "type": "link call",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 510,
        "y": 1260,
        "wires": [
            [
                "225bedd6b9d7924c"
            ]
        ]
    },
    {
        "id": "225bedd6b9d7924c",
        "type": "http response",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 710,
        "y": 1260,
        "wires": []
    },
    {
        "id": "b9bf86cdb9e87c8c",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "function",
        "func": "msg.collection = \"terms\";\n    msg.payload = [\n        {\n            $match: {\n                deleted: false\n            }\n        },\n        {\n            $lookup: {\n                from: \"attributes\",\n                localField: \"parent_id\",\n                foreignField: \"_id\",\n                as: \"terms\"\n            }\n        },\n        {\n            $project: {\n                _id: 1, // Include all fields from the \"attributes\" collection\n                name: 1,\n                description: 1,\n                // Add more fields as needed\n                terms: \"$terms\"\n            }\n        }\n    ];\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 1340,
        "wires": [
            [
                "838384331931f0d0"
            ]
        ]
    },
    {
        "id": "838384331931f0d0",
        "type": "link call",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "links": [
            "b7c366424b9b7e6e"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 490,
        "y": 1340,
        "wires": [
            [
                "225bedd6b9d7924c"
            ]
        ]
    },
    {
        "id": "70614985f556af14",
        "type": "subflow:95370d1e369768c7",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "x": 750,
        "y": 180,
        "wires": [
            [
                "ca419928cba01638"
            ],
            [
                "be090bf6086c2e5b"
            ]
        ]
    },
    {
        "id": "4075b70303747e97",
        "type": "subflow:95370d1e369768c7",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "x": 870,
        "y": 280,
        "wires": [
            [
                "1031137b79619212"
            ],
            [
                "bc36c7c20a9cfd11"
            ]
        ]
    },
    {
        "id": "4436e46248fbba34",
        "type": "link in",
        "z": "3b3162a2cd4b8878",
        "name": "find attr by id",
        "links": [],
        "x": 285,
        "y": 520,
        "wires": [
            [
                "e6b2afbef8c11258"
            ]
        ]
    },
    {
        "id": "b382d5a6c82dfe16",
        "type": "link out",
        "z": "3b3162a2cd4b8878",
        "name": "link out 7",
        "mode": "return",
        "links": [],
        "x": 1145,
        "y": 520,
        "wires": []
    },
    {
        "id": "e6b2afbef8c11258",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "function",
        "func": "msg.collection = \"attributes\";\nmsg.payload = {\n    $and: [\n        { _id:objectid(msg.payload._id)},\n        { deleted: false }\n    ]\n\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 420,
        "y": 520,
        "wires": [
            [
                "62ef0f0f33c75fdd"
            ]
        ]
    },
    {
        "id": "62ef0f0f33c75fdd",
        "type": "link call",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 610,
        "y": 520,
        "wires": [
            [
                "0a9e30cdc56196f6"
            ]
        ]
    },
    {
        "id": "0a9e30cdc56196f6",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "function",
        "func": "if (msg.payload.length > 0) {\n    msg.payload = msg.payload[0]\n    return [msg, null]\n} else {\n    return [null, msg]\n}\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 540,
        "wires": [
            [
                "b382d5a6c82dfe16"
            ],
            [
                "87ba6140dcf3df1d"
            ]
        ]
    },
    {
        "id": "87ba6140dcf3df1d",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "404",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 930,
        "y": 560,
        "wires": [
            [
                "41c5b2156090524a"
            ]
        ]
    },
    {
        "id": "41c5b2156090524a",
        "type": "http response",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1110,
        "y": 560,
        "wires": []
    },
    {
        "id": "b85a5984830c4ca4",
        "type": "link call",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "links": [
            "4436e46248fbba34"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 470,
        "y": 280,
        "wires": [
            [
                "d62e3c431cce0478"
            ]
        ]
    },
    {
        "id": "d62e3c431cce0478",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "function 9",
        "func": "msg.collection = \"attributes\";\nmsg.endpoint = `products/attributes/${msg.payload.wooCommerceId}`;\nmsg.method = \"PUT\";\nmsg.payload = {\n    ...msg.fromApp,\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 640,
        "y": 280,
        "wires": [
            [
                "4075b70303747e97"
            ]
        ]
    },
    {
        "id": "df0ad2128bad917a",
        "type": "subflow:95370d1e369768c7",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "x": 1110,
        "y": 360,
        "wires": [
            [
                "0a59694c327c8197"
            ],
            [
                "eabc941571390beb"
            ]
        ]
    },
    {
        "id": "e0caa07ac3ebe9e4",
        "type": "subflow:95370d1e369768c7",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "x": 870,
        "y": 880,
        "wires": [
            [
                "e52aa67d23edf43f"
            ],
            [
                "5b2e0bea5805449c"
            ]
        ]
    },
    {
        "id": "4b3bc8787ec35c6b",
        "type": "link call",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "links": [
            "4436e46248fbba34"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 510,
        "y": 880,
        "wires": [
            [
                "08fe2a290ba9c76f"
            ]
        ]
    },
    {
        "id": "08fe2a290ba9c76f",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "function 10",
        "func": "msg.endpoint = `products/attributes/${msg.payload.wooCommerceId}/terms`\nmsg.method = \"POST\";\n\nmsg.fromApp={\n    ...msg.fromApp,\n    parent: msg.payload.wooCommerceId,\n}\nmsg.payload = {\n    name: msg.fromApp.name,\n    slug: msg.fromApp.slug,\n    description: msg.fromApp.description,\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 880,
        "wires": [
            [
                "e0caa07ac3ebe9e4"
            ]
        ]
    },
    {
        "id": "206f67c13f7eb026",
        "type": "subflow:95370d1e369768c7",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "x": 1170,
        "y": 1000,
        "wires": [
            [
                "821dd74d89377212"
            ],
            [
                "7d66d6cc2024f2d9"
            ]
        ]
    },
    {
        "id": "c12da43f252d97f3",
        "type": "link call",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "links": [
            "4436e46248fbba34"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 850,
        "y": 960,
        "wires": [
            [
                "7470e77c65843ad1"
            ]
        ]
    },
    {
        "id": "d990aa27f52bf6f6",
        "type": "link call",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "links": [
            "4436e46248fbba34"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 450,
        "y": 1080,
        "wires": [
            [
                "4dcce081afa73f39"
            ]
        ]
    },
    {
        "id": "4dcce081afa73f39",
        "type": "function",
        "z": "3b3162a2cd4b8878",
        "name": "function 11",
        "func": "msg.endpoint = `products/attributes/${msg.payload.wooCommerceId}/terms/${msg.fromApp.wooCommerceId}`\nmsg.method = \"PUT\";\n\nmsg.fromApp = {\n    ...msg.fromApp,\n    parent: msg.payload.wooCommerceId,\n}\nmsg.payload = {\n    name: msg.fromApp.name,\n    slug: msg.fromApp.slug,\n    description: msg.fromApp.description,\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 1080,
        "wires": [
            [
                "1426be6c2b7d8a89"
            ]
        ]
    },
    {
        "id": "1426be6c2b7d8a89",
        "type": "subflow:95370d1e369768c7",
        "z": "3b3162a2cd4b8878",
        "name": "",
        "x": 810,
        "y": 1120,
        "wires": [
            [
                "bce2955d960805de"
            ],
            [
                "aeb166cf849c736e"
            ]
        ]
    },
    {
        "id": "023908cb77133639",
        "type": "function",
        "z": "7fa20f64a683a2de",
        "name": "create",
        "func": "msg.collection = \"products\"\nmsg.fromApp = {\n        ...msg.payload,\n        _id: objectid(),\n        deleted: false\n}\n\nif (!!msg.payload.categories.serie) {\n        msg.series = msg.payload.categories.serie \n        return [msg, null, null]\n} else if (!!msg.payload.categories.category) {\n        msg.categories = msg.payload.categories.category \n        return [null, msg, null]\n} else {\n        return [null, null, msg]\n}\n\nreturn msg;\n\n\n",
        "outputs": 3,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 270,
        "y": 120,
        "wires": [
            [
                "0196b7d53db91240"
            ],
            [
                "eebfeeb40f0c17da"
            ],
            [
                "b4de988573b59907"
            ]
        ]
    },
    {
        "id": "2b5553535db147e5",
        "type": "http in",
        "z": "7fa20f64a683a2de",
        "name": "",
        "url": "/createProduct",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 90,
        "y": 120,
        "wires": [
            [
                "023908cb77133639",
                "136540546e9bf479"
            ]
        ]
    },
    {
        "id": "3bdaf3616fd0254a",
        "type": "http response",
        "z": "7fa20f64a683a2de",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1950,
        "y": 120,
        "wires": []
    },
    {
        "id": "c9cb8656f69750eb",
        "type": "http in",
        "z": "7fa20f64a683a2de",
        "name": "",
        "url": "/getProducts",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 80,
        "y": 440,
        "wires": [
            [
                "26a5cb76b096247a"
            ]
        ]
    },
    {
        "id": "46d921fab5275373",
        "type": "link call",
        "z": "7fa20f64a683a2de",
        "name": "",
        "links": [
            "1764f8568a80ddbd"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1710,
        "y": 120,
        "wires": [
            [
                "3bdaf3616fd0254a"
            ]
        ]
    },
    {
        "id": "f354cebc9ab7760a",
        "type": "link call",
        "z": "7fa20f64a683a2de",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 470,
        "y": 440,
        "wires": [
            [
                "1f07084e38b716a6"
            ]
        ]
    },
    {
        "id": "1f07084e38b716a6",
        "type": "http response",
        "z": "7fa20f64a683a2de",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 670,
        "y": 440,
        "wires": []
    },
    {
        "id": "26a5cb76b096247a",
        "type": "function",
        "z": "7fa20f64a683a2de",
        "name": "function",
        "func": "msg.collection = \"products\"\nmsg.payload = {\n    deleted: false\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 280,
        "y": 440,
        "wires": [
            [
                "f354cebc9ab7760a"
            ]
        ]
    },
    {
        "id": "3ca2b1b7a52e0be3",
        "type": "http in",
        "z": "7fa20f64a683a2de",
        "name": "",
        "url": "/getProduct",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 80,
        "y": 480,
        "wires": [
            [
                "b34528e3e7b356c6"
            ]
        ]
    },
    {
        "id": "d4251ac29fa3cb33",
        "type": "link call",
        "z": "7fa20f64a683a2de",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 470,
        "y": 480,
        "wires": [
            [
                "74fdf1644f03208f"
            ]
        ]
    },
    {
        "id": "74fdf1644f03208f",
        "type": "http response",
        "z": "7fa20f64a683a2de",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 670,
        "y": 480,
        "wires": []
    },
    {
        "id": "b34528e3e7b356c6",
        "type": "function",
        "z": "7fa20f64a683a2de",
        "name": "function",
        "func": "msg.collection = \"products\"\nmsg.payload = {\n    _id: objectid(msg.payload._id),\n    deleted: false\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 280,
        "y": 480,
        "wires": [
            [
                "d4251ac29fa3cb33"
            ]
        ]
    },
    {
        "id": "97d984048f886390",
        "type": "http in",
        "z": "7fa20f64a683a2de",
        "name": "",
        "url": "/deleteProduct",
        "method": "delete",
        "upload": false,
        "swaggerDoc": "",
        "x": 100,
        "y": 260,
        "wires": [
            [
                "b0e4ae1c172eb29c"
            ]
        ]
    },
    {
        "id": "47324ff7ba1b48c0",
        "type": "function",
        "z": "7fa20f64a683a2de",
        "name": "delete",
        "func": "msg.collection = \"products\"\nmsg.payload = msg.payload[0],\nmsg.endpoint = `products/${msg.payload.wooCommerceId}`\nmsg.method = \"Delete\";\nmsg.query = {\n    _id: objectid(msg.payload._id)\n}\ndelete msg.payload._id;\nmsg.payload = {\n    $set: {\n        ...msg.payload,\n        \"name\": msg.payload.name + \"(DELETED_\" + Date.now() + \")\",\n        \"deleted\": true,\n        \"slug\": msg.payload.slug + \"(DELETED_\" + Date.now() + \")\",\n    }\n}\nreturn msg;\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 670,
        "y": 260,
        "wires": [
            [
                "b308c591e148c01c"
            ]
        ]
    },
    {
        "id": "63a97efd53a821b6",
        "type": "link call",
        "z": "7fa20f64a683a2de",
        "name": "",
        "links": [
            "286431cd31c9fc7a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1340,
        "y": 240,
        "wires": [
            [
                "750e95fd5104e848"
            ]
        ]
    },
    {
        "id": "750e95fd5104e848",
        "type": "http response",
        "z": "7fa20f64a683a2de",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1590,
        "y": 240,
        "wires": []
    },
    {
        "id": "b0e4ae1c172eb29c",
        "type": "function",
        "z": "7fa20f64a683a2de",
        "name": "function",
        "func": "msg.collection = \"products\"\nmsg.payload = {\n    _id: objectid(msg.payload._id),\n    deleted: false\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 300,
        "y": 260,
        "wires": [
            [
                "066f97fcad137019"
            ]
        ]
    },
    {
        "id": "066f97fcad137019",
        "type": "link call",
        "z": "7fa20f64a683a2de",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 450,
        "y": 260,
        "wires": [
            [
                "47324ff7ba1b48c0"
            ]
        ]
    },
    {
        "id": "6f2f8bb1a320f3a4",
        "type": "link in",
        "z": "7fa20f64a683a2de",
        "name": "find",
        "links": [],
        "x": 25,
        "y": 560,
        "wires": [
            [
                "affd2c739bf4f6f5"
            ]
        ]
    },
    {
        "id": "f7e662b54a1df6e0",
        "type": "link out",
        "z": "7fa20f64a683a2de",
        "name": "link out 8",
        "mode": "return",
        "links": [],
        "x": 425,
        "y": 560,
        "wires": []
    },
    {
        "id": "c8682522b6770101",
        "type": "function",
        "z": "7fa20f64a683a2de",
        "name": "function",
        "func": "if (msg.payload.length > 0) {\n    return [msg, null]\n} else {\n    return [null, msg]\n}",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 580,
        "wires": [
            [
                "f7e662b54a1df6e0"
            ],
            [
                "e33dc6fc9997c89c"
            ]
        ]
    },
    {
        "id": "affd2c739bf4f6f5",
        "type": "link call",
        "z": "7fa20f64a683a2de",
        "name": "",
        "links": [
            "346e518816416d1d"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 170,
        "y": 560,
        "wires": [
            [
                "c8682522b6770101"
            ]
        ]
    },
    {
        "id": "e33dc6fc9997c89c",
        "type": "function",
        "z": "7fa20f64a683a2de",
        "name": "404",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 620,
        "wires": [
            [
                "c54b719880f1b614"
            ]
        ]
    },
    {
        "id": "c54b719880f1b614",
        "type": "http response",
        "z": "7fa20f64a683a2de",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 710,
        "y": 620,
        "wires": []
    },
    {
        "id": "0196b7d53db91240",
        "type": "function",
        "z": "7fa20f64a683a2de",
        "name": "function 12",
        "func": "msg.collection = \"series\";\nmsg.payload = {\n    _id: objectid(msg.fromApp.categories.serie)\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 610,
        "y": 20,
        "wires": [
            [
                "208d344fd311324b"
            ]
        ]
    },
    {
        "id": "208d344fd311324b",
        "type": "link call",
        "z": "7fa20f64a683a2de",
        "name": "",
        "links": [
            "6f2f8bb1a320f3a4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 850,
        "y": 60,
        "wires": [
            [
                "b4de988573b59907",
                "3a69a6f065dd3ca2"
            ]
        ]
    },
    {
        "id": "eebfeeb40f0c17da",
        "type": "function",
        "z": "7fa20f64a683a2de",
        "name": "function 13",
        "func": "msg.collection = \"categories\"\nmsg.payload = {\n    _id: objectid(msg.fromApp.categories.category)\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 610,
        "y": 60,
        "wires": [
            [
                "208d344fd311324b"
            ]
        ]
    },
    {
        "id": "b4de988573b59907",
        "type": "function",
        "z": "7fa20f64a683a2de",
        "name": "function 14",
        "func": "msg.endpoint = \"products\";\nmsg.method= \"POST\";\nmsg.collection = \"products\";\nmsg.findCategory =  msg.payload;\nnode.warn(msg.series);\n\nlet categories = [];\nlet categories_mongo_ids = [];\nlet series_mongo_ids = [];\nlet series = [];\nlet images = [];\nif (msg.categories){\n    categories = msg.findCategory.map((elem) => { return {id: elem.wooCommerceId}});\n    categories_mongo_ids = msg.findCategory.map((elem) => { return elem._id });\n}\nif (msg.series){\n    series = msg.findCategory.map((elem) => { return {id: elem.wooCommerceId} });\n    series_mongo_ids = msg.findCategory.map((elem) => { return elem._id });\n}\nif(msg.fromApp.images[0]){\n    images = msg.fromApp.images.map((elem)=>{return {src: elem.url}})\n}\nmsg.attributes = msg.fromApp.attributes ? msg.fromApp.attributes : [];\nmsg.payload = {\n    ...msg.fromApp,\n    images,\n    attributes: msg.attributes,\n    categories,\n    categories_mongo_ids,\n    series,\n    series_mongo_ids,\n    deleted: false\n}\nmsg.fromApp = msg.payload;\nmsg.payload = {\n    ...msg.fromApp,\n    images,\n    attributes: msg.attributes,\n    categories: [...categories, ...series],\n    deleted: false\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1030,
        "y": 120,
        "wires": [
            [
                "faa0703d68ccbd7a",
                "95d9be92c94dc0c2"
            ]
        ]
    },
    {
        "id": "faa0703d68ccbd7a",
        "type": "subflow:95370d1e369768c7",
        "z": "7fa20f64a683a2de",
        "name": "",
        "x": 1250,
        "y": 120,
        "wires": [
            [
                "b3200fcab136e1d1",
                "caedb3e04d0dd48c"
            ],
            [
                "c7c9ce16f5fe8c70"
            ]
        ]
    },
    {
        "id": "b3200fcab136e1d1",
        "type": "function",
        "z": "7fa20f64a683a2de",
        "name": "function 15",
        "func": "const {id, ...rest} = msg.payload\nmsg.payload = {\n    ...msg.fromApp, \n    ...rest,\n    wooCommerceId: msg.payload.id,\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1470,
        "y": 120,
        "wires": [
            [
                "46d921fab5275373"
            ]
        ]
    },
    {
        "id": "c7c9ce16f5fe8c70",
        "type": "function",
        "z": "7fa20f64a683a2de",
        "name": "wpError",
        "func": "msg.payload = {\n    success: false,\n    error: msg.payload\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1460,
        "y": 160,
        "wires": [
            [
                "68af30efc052a9a8"
            ]
        ]
    },
    {
        "id": "68af30efc052a9a8",
        "type": "http response",
        "z": "7fa20f64a683a2de",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1950,
        "y": 160,
        "wires": []
    },
    {
        "id": "26f6d9ddcfa69b45",
        "type": "function",
        "z": "7fa20f64a683a2de",
        "name": "function 16",
        "func": "msg.categories = msg.payload;\nmsg.collection = \"series\";\nmsg.payload = {\n    _id: objectid(msg.fromApp.categories.serie)\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 1250,
        "y": 340,
        "wires": [
            [
                "b66d56e35f94427f"
            ]
        ]
    },
    {
        "id": "b66d56e35f94427f",
        "type": "link call",
        "z": "7fa20f64a683a2de",
        "name": "",
        "links": [
            "6f2f8bb1a320f3a4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1450,
        "y": 380,
        "wires": [
            [
                "fc5af06b3b2466f1"
            ]
        ]
    },
    {
        "id": "5c732afeaea591b6",
        "type": "function",
        "z": "7fa20f64a683a2de",
        "name": "function 17",
        "func": "msg.collection = \"categories\"\nmsg.payload = {\n    _id: objectid(msg.fromApp.categories.category)\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 1250,
        "y": 380,
        "wires": [
            [
                "b66d56e35f94427f"
            ]
        ]
    },
    {
        "id": "1f5ad1a5096cbf2e",
        "type": "http in",
        "z": "7fa20f64a683a2de",
        "name": "",
        "url": "/updateProduct",
        "method": "put",
        "upload": false,
        "swaggerDoc": "",
        "x": 830,
        "y": 500,
        "wires": [
            [
                "302f859e28fa0bef"
            ]
        ]
    },
    {
        "id": "cc8bd294566770c1",
        "type": "link call",
        "z": "7fa20f64a683a2de",
        "name": "",
        "links": [
            "286431cd31c9fc7a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 2520,
        "y": 560,
        "wires": [
            [
                "5c7191f462cd28a0"
            ]
        ]
    },
    {
        "id": "5c7191f462cd28a0",
        "type": "http response",
        "z": "7fa20f64a683a2de",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 2670,
        "y": 560,
        "wires": []
    },
    {
        "id": "302f859e28fa0bef",
        "type": "function",
        "z": "7fa20f64a683a2de",
        "name": "update",
        "func": "msg.collection = \"products\"\nmsg.query = {\n        _id: objectid(msg.payload._id)\n}\nmsg.fromApp = {\n        ...msg.payload,\n        deleted: false\n}\nnode.warn(msg.payload.categories.category);\nif (!!msg.payload.categories.serie){\n        msg.series = msg.payload.categories.serie\n        return [msg, null, null]\n} else if (!!msg.payload.categories.category){\n        msg.categories = msg.payload.categories.category\n        return [null, msg, null]\n}else{\n        return [null, null, msg]\n}",
        "outputs": 3,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 1030,
        "y": 500,
        "wires": [
            [
                "26f6d9ddcfa69b45"
            ],
            [
                "5c732afeaea591b6"
            ],
            [
                "fc5af06b3b2466f1"
            ]
        ]
    },
    {
        "id": "9cc87096c6d7d443",
        "type": "function",
        "z": "7fa20f64a683a2de",
        "name": "function 18",
        "func": "msg.endpoint = `products/${msg.payload[0].wooCommerceId}`;\nmsg.method= \"PUT\";\nmsg.collection = \"products\";\n\nlet categories = [];\nlet categories_mongo_ids = [];\nlet series_mongo_ids = [];\nlet series = [];\nlet images = [];\nif (msg.categories){\n    categories = msg.findCategory.map((elem) => { return {id: +elem.wooCommerceId}});\n    categories_mongo_ids = msg.findCategory.map((elem) => { return elem._id });\n}\nif (msg.serie){\n    series = msg.findCategory.map((elem) => { return {id: +elem.wooCommerceId} });\n    series_mongo_ids = msg.findCategory.map((elem) => { return elem._id });\n}\nif (msg.payload.images) {\n    images = msg.images.map((elem) => { return { src: elem.src } })\n}\nmsg.attributes = msg.fromApp.attributes ? msg.fromApp.attributes : [];\n\n\nmsg.payload = {\n    ...msg.fromApp,\n    attributes: msg.attributes,\n    categories,\n    categories_mongo_ids,\n    series,\n    series_mongo_ids,\n    deleted: false\n}\nmsg.fromApp = msg.payload;\nmsg.payload = {\n    ...msg.fromApp,\n    attributes: msg.attributes,\n    categories: [...series, ...categories],\n    deleted: false\n}\nconst { _id, id, ...rest } = msg.payload\nmsg.payload = {\n    ...rest\n}\nmsg.fromApp = {...rest}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 500,
        "wires": [
            [
                "937504bc0f55e95d",
                "2bc4c887aaa344ea"
            ]
        ]
    },
    {
        "id": "937504bc0f55e95d",
        "type": "subflow:95370d1e369768c7",
        "z": "7fa20f64a683a2de",
        "name": "",
        "x": 1870,
        "y": 580,
        "wires": [
            [
                "9f922ad5cec045a3",
                "7211dc3504b259e5"
            ],
            [
                "a621fcf7b49aac37"
            ]
        ]
    },
    {
        "id": "a621fcf7b49aac37",
        "type": "function",
        "z": "7fa20f64a683a2de",
        "name": "wpError",
        "func": "msg.payload = {\n    success: false,\n    error: msg.payload\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2140,
        "y": 600,
        "wires": [
            [
                "6d812499de517c51"
            ]
        ]
    },
    {
        "id": "6d812499de517c51",
        "type": "http response",
        "z": "7fa20f64a683a2de",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 2630,
        "y": 600,
        "wires": []
    },
    {
        "id": "9f922ad5cec045a3",
        "type": "function",
        "z": "7fa20f64a683a2de",
        "name": "function 19",
        "func": "msg.payload = {\n    $set: {\n        ...msg.fromApp,\n        ...msg.payload\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 560,
        "wires": [
            [
                "cc8bd294566770c1"
            ]
        ]
    },
    {
        "id": "fc5af06b3b2466f1",
        "type": "function",
        "z": "7fa20f64a683a2de",
        "name": "function 21",
        "func": "msg.collection = \"products\"\nmsg.findCategory = msg.payload\nmsg.payload = {\n    _id: objectid(msg.fromApp._id),\n    deleted: false\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "objectid",
                "module": "objectid"
            }
        ],
        "x": 1430,
        "y": 600,
        "wires": [
            [
                "5b889654eee7932a"
            ]
        ]
    },
    {
        "id": "5b889654eee7932a",
        "type": "link call",
        "z": "7fa20f64a683a2de",
        "name": "",
        "links": [
            "6f2f8bb1a320f3a4"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1590,
        "y": 580,
        "wires": [
            [
                "9cc87096c6d7d443",
                "2bc4c887aaa344ea"
            ]
        ]
    },
    {
        "id": "caedb3e04d0dd48c",
        "type": "debug",
        "z": "7fa20f64a683a2de",
        "name": "debug 15",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1520,
        "y": 40,
        "wires": []
    },
    {
        "id": "2bc4c887aaa344ea",
        "type": "debug",
        "z": "7fa20f64a683a2de",
        "name": "debug 16",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1800,
        "y": 640,
        "wires": []
    },
    {
        "id": "b308c591e148c01c",
        "type": "subflow:95370d1e369768c7",
        "z": "7fa20f64a683a2de",
        "name": "",
        "x": 910,
        "y": 260,
        "wires": [
            [
                "3a99fc7ba6d9f6be"
            ],
            [
                "86e5b48721732f0e"
            ]
        ]
    },
    {
        "id": "3a99fc7ba6d9f6be",
        "type": "function",
        "z": "7fa20f64a683a2de",
        "name": "function 22",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1150,
        "y": 240,
        "wires": [
            [
                "63a97efd53a821b6"
            ]
        ]
    },
    {
        "id": "7211dc3504b259e5",
        "type": "debug",
        "z": "7fa20f64a683a2de",
        "name": "debug 19",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload.categories",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2160,
        "y": 480,
        "wires": []
    },
    {
        "id": "95d9be92c94dc0c2",
        "type": "debug",
        "z": "7fa20f64a683a2de",
        "name": "debug 26",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 80,
        "wires": []
    },
    {
        "id": "136540546e9bf479",
        "type": "debug",
        "z": "7fa20f64a683a2de",
        "name": "debug 27",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 480,
        "y": 200,
        "wires": []
    },
    {
        "id": "86e5b48721732f0e",
        "type": "http response",
        "z": "7fa20f64a683a2de",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1130,
        "y": 280,
        "wires": []
    },
    {
        "id": "3a69a6f065dd3ca2",
        "type": "debug",
        "z": "7fa20f64a683a2de",
        "name": "debug 28",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1060,
        "y": 60,
        "wires": []
    },
    {
        "id": "43e7fff7d5436eb4",
        "type": "function",
        "z": "831d0299e53b0c29",
        "name": "slug validayion",
        "func": "if (typeof msg.payload.slug !== 'string') {\n    return [null, msg];\n}\n\nreturn msg;",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 200,
        "y": 60,
        "wires": [
            [],
            [
                "8f10ebaa2aeb46f6"
            ]
        ]
    },
    {
        "id": "8f10ebaa2aeb46f6",
        "type": "function",
        "z": "831d0299e53b0c29",
        "name": "400",
        "func": "msg.payload = {\n    success: false,\n    error: `400 slug unvalid ${msg.payload.slug}`\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 100,
        "wires": [
            [
                "55b2d81bbc5d6e8c"
            ]
        ]
    },
    {
        "id": "55b2d81bbc5d6e8c",
        "type": "http response",
        "z": "831d0299e53b0c29",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 630,
        "y": 100,
        "wires": []
    }
]